<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Example 03: Estimate population diet • FishStomachs</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Example 03: Estimate population diet">
<meta property="og:description" content="FishStomachs">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FishStomachs</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/FishStomachs.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ex01_Read_and_manipulate_data.html">example 01: Read and manipulate data</a>
    </li>
    <li>
      <a href="../articles/ex02_More_data_manipulations.html">Example 02: More data manipulations</a>
    </li>
    <li>
      <a href="../articles/ex03_Estimate_population_diet.html">Example 03: Estimate population diet</a>
    </li>
    <li>
      <a href="../articles/ex04_Population_diet.html">Example 04: Population diet</a>
    </li>
    <li>
      <a href="../articles/ex05_Create_data_for_model.html">Example 05:Create data for model</a>
    </li>
    <li>
      <a href="../articles/ex06_Bootstrapping.html">Example 06 Bootstrapping</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Example 03: Estimate population diet</h1>
            
      
      
      <div class="hidden name"><code>ex03_Estimate_population_diet.Rmd</code></div>

    </div>

    
    
<p>This example shows the data compilation of stomach contents
observations into population diet after the initial data manipulation
have been done (see example 1 and 2). The compilation includes assigning
partly identified prey items into known preys, and calculation of the
population diet from a weighed mean of the observed data. Both
re-distribution of partly identified preys and raising the observation
to population mean requires stratification of data in space and
time.</p>
<p>First data from the previous data manipulations (“Example 02”) are
loaded.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">FishStomachs</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span> package <span class="op">=</span> <span class="st">"FishStomachs"</span><span class="op">)</span>,<span class="st">"extdata"</span>,<span class="st">"ex02.Rdata"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">s</span></span>
<span><span class="co">#&gt; Object of class 'STOMobs'</span></span>
<span><span class="co">#&gt; ===========================</span></span>
<span><span class="co">#&gt; Number of samples: 4104 </span></span>
<span><span class="co">#&gt; Number stomachs: 9660 </span></span>
<span><span class="co">#&gt; Predators: Gadus morhua </span></span>
<span><span class="co">#&gt; Number of prey names: 210 </span></span>
<span><span class="co">#&gt; Years: 1991 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; TRUE:  Changes done</span></span>
<span><span class="co">#&gt; TRUE:  Prey weights by record done</span></span>
<span><span class="co">#&gt; TRUE:  Bias corrected, energy contents, armament etc</span></span>
<span><span class="co">#&gt; TRUE:  Predator size class assigned</span></span>
<span><span class="co">#&gt; TRUE:  Bias corrected, regurgitated stomachs</span></span>
<span><span class="co">#&gt; TRUE:  Prey size class assigned</span></span>
<span><span class="co">#&gt; FALSE: Aggregate by sample ID and predator and prey size group</span></span>
<span><span class="co">#&gt; FALSE: Temporal and spatial strata added</span></span>
<span><span class="co">#&gt; FALSE: Allocate partly identified prey species</span></span>
<span><span class="co">#&gt; FALSE: Allocate missing prey length</span></span>
<span></span>
<span><span class="fu"><a href="../reference/do_detailed_output.html">do_detailed_output</a></span><span class="op">(</span><span class="va">s</span>, by_sample_id<span class="op">=</span><span class="cn">TRUE</span>,to_screen<span class="op">=</span><span class="cn">TRUE</span>, label<span class="op">=</span><span class="st">'Begin example 3'</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Begin example 3 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  sample_id: Gadus morhua_FRA_y:91_q:1_ID:1008  fish_id: 1008 </span></span>
<span><span class="co">#&gt; Number of stomachs ('n_tot'): 1 </span></span>
<span><span class="co">#&gt;                              70     100      150     200      250   9999</span></span>
<span><span class="co">#&gt; Aphrodite aculeata           NA      NA       NA      NA       NA 6128.7</span></span>
<span><span class="co">#&gt; Callionymus lyra         6171.7      NA       NA      NA       NA     NA</span></span>
<span><span class="co">#&gt; Clupea                       NA  1376.4       NA      NA       NA     NA</span></span>
<span><span class="co">#&gt; Clupea harengus              NA      NA       NA 40580.2       NA     NA</span></span>
<span><span class="co">#&gt; Corystes cassivelanus        NA      NA       NA      NA       NA  850.6</span></span>
<span><span class="co">#&gt; Hippogloss. Platessoides     NA  7703.9  20190.5      NA       NA     NA</span></span>
<span><span class="co">#&gt; Limanda limanda          1346.0 25534.2  81084.9 42601.9       NA     NA</span></span>
<span><span class="co">#&gt; Macropipus holsatus          NA      NA       NA      NA       NA  622.9</span></span>
<span><span class="co">#&gt; Merlangius merlangus         NA      NA       NA      NA 129775.9     NA</span></span>
<span><span class="co">#&gt; Solea solea                  NA      NA  31524.0      NA       NA     NA</span></span>
<span><span class="co">#&gt; all                      7517.7 34614.5 132799.3 83182.1 129775.9 7602.2</span></span>
<span><span class="co">#&gt;                               all</span></span>
<span><span class="co">#&gt; Aphrodite aculeata         6128.7</span></span>
<span><span class="co">#&gt; Callionymus lyra           6171.7</span></span>
<span><span class="co">#&gt; Clupea                     1376.4</span></span>
<span><span class="co">#&gt; Clupea harengus           40580.2</span></span>
<span><span class="co">#&gt; Corystes cassivelanus       850.6</span></span>
<span><span class="co">#&gt; Hippogloss. Platessoides  27894.3</span></span>
<span><span class="co">#&gt; Limanda limanda          150566.9</span></span>
<span><span class="co">#&gt; Macropipus holsatus         622.9</span></span>
<span><span class="co">#&gt; Merlangius merlangus     129775.9</span></span>
<span><span class="co">#&gt; Solea solea               31524.0</span></span>
<span><span class="co">#&gt; all                      395491.7</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  sample_id: Gadus morhua_SCO_y:91_q:1_ID:582  fish_id: 582 </span></span>
<span><span class="co">#&gt; Number of stomachs ('n_tot'): 4 </span></span>
<span><span class="co">#&gt;                         100     200 9999     all</span></span>
<span><span class="co">#&gt; Clupea harengus          NA 25852.5   NA 25852.5</span></span>
<span><span class="co">#&gt; Trisopterus esmarkii 7048.3      NA 10.2  7058.5</span></span>
<span><span class="co">#&gt; all                  7048.3 25852.5 10.2 32911.0</span></span></code></pre></div>
<div class="section level3">
<h3 id="group-prey-species">Group prey species<a class="anchor" aria-label="anchor" href="#group-prey-species"></a>
</h3>
<p>The Multi species model, SMS, groups the prey species into commercial
species and a other species, both fish and invertebrates, into “Other
food”. For this the NODC system is convenient due to its hierarchical
structure. First, the structure for grouping is made input files. Here,
data files from the FishStomachs package are used to produce the key
(data set NODC_split) to split/aggregate data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">a</span><span class="op">&lt;-</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span> package <span class="op">=</span> <span class="st">"FishStomachs"</span><span class="op">)</span>,<span class="st">"extdata"</span>,<span class="st">"species_info.csv"</span><span class="op">)</span>,</span>
<span>        col_types <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html" class="external-link">cols</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">nodc</span><span class="op">&gt;</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">prey_sp</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">species</span>,<span class="va">nodc</span><span class="op">)</span><span class="op"><a href="../reference/pipe.html">%&gt;%</a></span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>species_group<span class="op">=</span><span class="va">species</span>,First<span class="op">=</span><span class="va">nodc</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Last<span class="op">=</span><span class="va">First</span>,named<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt;   species_group                 First       Last named</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Gadus morhua             <span style="text-decoration: underline;">8</span>791<span style="text-decoration: underline;">030</span>402 <span style="text-decoration: underline;">8</span>791<span style="text-decoration: underline;">030</span>402 TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Merlangius merlangus     <span style="text-decoration: underline;">8</span>791<span style="text-decoration: underline;">031</span>801 <span style="text-decoration: underline;">8</span>791<span style="text-decoration: underline;">031</span>801 TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Melanogrammus aeglefinus <span style="text-decoration: underline;">8</span>791<span style="text-decoration: underline;">031</span>301 <span style="text-decoration: underline;">8</span>791<span style="text-decoration: underline;">031</span>301 TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Clupea harengus          <span style="text-decoration: underline;">8</span>747<span style="text-decoration: underline;">010</span>201 <span style="text-decoration: underline;">8</span>747<span style="text-decoration: underline;">010</span>201 TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Ammodytidae              <span style="text-decoration: underline;">8</span>845<span style="text-decoration: underline;">010</span>000 <span style="text-decoration: underline;">8</span>845<span style="text-decoration: underline;">010</span>000 TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Trisopterus esmarkii     <span style="text-decoration: underline;">8</span>791<span style="text-decoration: underline;">031</span>703 <span style="text-decoration: underline;">8</span>791<span style="text-decoration: underline;">031</span>703 TRUE</span></span>
<span></span>
<span></span>
<span><span class="va">b</span><span class="op">&lt;-</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span> package <span class="op">=</span> <span class="st">"FishStomachs"</span><span class="op">)</span>,<span class="st">"extdata"</span>,<span class="st">"other_food_nodc.csv"</span><span class="op">)</span>,</span>
<span>        col_types <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html" class="external-link">cols</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>named<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt;   species_group      First       Last named</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> other          400<span style="text-decoration: underline;">000</span>000 <span style="text-decoration: underline;">8</span>499<span style="text-decoration: underline;">999</span>999 FALSE</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Other fish    <span style="text-decoration: underline;">8</span>500<span style="text-decoration: underline;">000</span>000 <span style="text-decoration: underline;">8</span>747<span style="text-decoration: underline;">009</span>999 FALSE</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Clupeidae     <span style="text-decoration: underline;">8</span>747<span style="text-decoration: underline;">010</span>000 <span style="text-decoration: underline;">8</span>747<span style="text-decoration: underline;">019</span>999 FALSE</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Other fish    <span style="text-decoration: underline;">8</span>747<span style="text-decoration: underline;">020</span>000 <span style="text-decoration: underline;">8</span>791<span style="text-decoration: underline;">029</span>999 FALSE</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Gadidae       <span style="text-decoration: underline;">8</span>791<span style="text-decoration: underline;">030</span>000 <span style="text-decoration: underline;">8</span>791<span style="text-decoration: underline;">031</span>999 FALSE</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Other fish    <span style="text-decoration: underline;">8</span>791<span style="text-decoration: underline;">032</span>000 <span style="text-decoration: underline;">8</span>999<span style="text-decoration: underline;">999</span>999 FALSE</span></span>
<span></span>
<span><span class="va">NODC_split</span><span class="op">&lt;-</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">a</span>,<span class="va">b</span><span class="op">)</span></span>
<span><span class="va">NODC_split</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 14 × 4</span></span></span>
<span><span class="co">#&gt;    species_group                 First       Last named</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Gadus morhua             <span style="text-decoration: underline;">8</span>791<span style="text-decoration: underline;">030</span>402 <span style="text-decoration: underline;">8</span>791<span style="text-decoration: underline;">030</span>402 TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Merlangius merlangus     <span style="text-decoration: underline;">8</span>791<span style="text-decoration: underline;">031</span>801 <span style="text-decoration: underline;">8</span>791<span style="text-decoration: underline;">031</span>801 TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Melanogrammus aeglefinus <span style="text-decoration: underline;">8</span>791<span style="text-decoration: underline;">031</span>301 <span style="text-decoration: underline;">8</span>791<span style="text-decoration: underline;">031</span>301 TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Clupea harengus          <span style="text-decoration: underline;">8</span>747<span style="text-decoration: underline;">010</span>201 <span style="text-decoration: underline;">8</span>747<span style="text-decoration: underline;">010</span>201 TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Ammodytidae              <span style="text-decoration: underline;">8</span>845<span style="text-decoration: underline;">010</span>000 <span style="text-decoration: underline;">8</span>845<span style="text-decoration: underline;">010</span>000 TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Trisopterus esmarkii     <span style="text-decoration: underline;">8</span>791<span style="text-decoration: underline;">031</span>703 <span style="text-decoration: underline;">8</span>791<span style="text-decoration: underline;">031</span>703 TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Sprattus sprattus        <span style="text-decoration: underline;">8</span>747<span style="text-decoration: underline;">011</span>701 <span style="text-decoration: underline;">8</span>747<span style="text-decoration: underline;">011</span>701 TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> other                     400<span style="text-decoration: underline;">000</span>000 <span style="text-decoration: underline;">8</span>499<span style="text-decoration: underline;">999</span>999 FALSE</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Other fish               <span style="text-decoration: underline;">8</span>500<span style="text-decoration: underline;">000</span>000 <span style="text-decoration: underline;">8</span>747<span style="text-decoration: underline;">009</span>999 FALSE</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Clupeidae                <span style="text-decoration: underline;">8</span>747<span style="text-decoration: underline;">010</span>000 <span style="text-decoration: underline;">8</span>747<span style="text-decoration: underline;">019</span>999 FALSE</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> Other fish               <span style="text-decoration: underline;">8</span>747<span style="text-decoration: underline;">020</span>000 <span style="text-decoration: underline;">8</span>791<span style="text-decoration: underline;">029</span>999 FALSE</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> Gadidae                  <span style="text-decoration: underline;">8</span>791<span style="text-decoration: underline;">030</span>000 <span style="text-decoration: underline;">8</span>791<span style="text-decoration: underline;">031</span>999 FALSE</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> Other fish               <span style="text-decoration: underline;">8</span>791<span style="text-decoration: underline;">032</span>000 <span style="text-decoration: underline;">8</span>999<span style="text-decoration: underline;">999</span>999 FALSE</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> unknown                  <span style="text-decoration: underline;">9</span>000<span style="text-decoration: underline;">000</span>000 <span style="text-decoration: underline;">9</span>999<span style="text-decoration: underline;">999</span>999 FALSE</span></span></code></pre></div>
<p>The NODC_split data includes the named preys (named=TRUE) that is
included in the SMS model. The other group of preys (named=FALSE )
includes other prey groups that not fully species identified or species
identified preys which belongs to the group of “other food” where</p>
<ul>
<li>“other” contains the NODC range for invertebrate preys that that
will part of the “other food” group in SMS.</li>
<li>“other fish” contains the NODC range for fish preys that is not a
names species and not a special group.<br>
</li>
<li>“Clupeidae” includes herring like species (e.g. herring and sprat)
that could not be identified at species level.</li>
<li>“Gadidae” includes cod like species (e.g. cod, whiting) that could
not be identified at species level.</li>
<li>“unknown” includes unidentified remains, both invertebrates and
vertebrates.</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">s</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/group_prey_species.html">group_prey_species</a></span><span class="op">(</span><span class="va">s</span>,NODC_split<span class="op">=</span><span class="va">NODC_split</span>,show_allocations<span class="op">=</span><span class="cn">FALSE</span> <span class="op">)</span></span>
<span><span class="fu"><a href="../reference/do_detailed_output.html">do_detailed_output</a></span><span class="op">(</span><span class="va">s</span>, by_sample_id<span class="op">=</span><span class="cn">TRUE</span>,to_screen<span class="op">=</span><span class="cn">TRUE</span>, label<span class="op">=</span><span class="st">'After group_prey_species'</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  After group_prey_species </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  sample_id: Gadus morhua_FRA_y:91_q:1_ID:1008  fish_id: 1008 </span></span>
<span><span class="co">#&gt; Number of stomachs ('n_tot'): 1 </span></span>
<span><span class="co">#&gt;                          70     100      150     200      250   9999      all</span></span>
<span><span class="co">#&gt; Clupea harengus          NA      NA       NA 40580.2       NA     NA  40580.2</span></span>
<span><span class="co">#&gt; Clupeidae                NA  1376.4       NA      NA       NA     NA   1376.4</span></span>
<span><span class="co">#&gt; Merlangius merlangus     NA      NA       NA      NA 129775.9     NA 129775.9</span></span>
<span><span class="co">#&gt; other                    NA      NA       NA      NA       NA 7602.2   7602.2</span></span>
<span><span class="co">#&gt; Other fish           7517.7 33238.1 132799.3 42601.9       NA     NA 216157.0</span></span>
<span><span class="co">#&gt; all                  7517.7 34614.5 132799.3 83182.1 129775.9 7602.2 395491.7</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  sample_id: Gadus morhua_SCO_y:91_q:1_ID:582  fish_id: 582 </span></span>
<span><span class="co">#&gt; Number of stomachs ('n_tot'): 4 </span></span>
<span><span class="co">#&gt;                         100     200 9999     all</span></span>
<span><span class="co">#&gt; Clupea harengus          NA 25852.5   NA 25852.5</span></span>
<span><span class="co">#&gt; Trisopterus esmarkii 7048.3      NA 10.2  7058.5</span></span>
<span><span class="co">#&gt; all                  7048.3 25852.5 10.2 32911.0</span></span></code></pre></div>
<p>Data are now aggregated in the specified groups, as shown above.</p>
</div>
<div class="section level3">
<h3 id="aggregation-of-stomach-within-the-same-sample_id-and-predator-size-class">Aggregation of stomach within the same sample_Id and predator size
class<a class="anchor" aria-label="anchor" href="#aggregation-of-stomach-within-the-same-sample_id-and-predator-size-class"></a>
</h3>
<p>The individual stomachs from the same sample Id, predator and prey
size classes are aggregated.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/aggregate_within_sample.html">aggregate_within_sample</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span></span>
<span><span class="va">s</span></span>
<span><span class="co">#&gt; Object of class 'STOMobs'</span></span>
<span><span class="co">#&gt; ===========================</span></span>
<span><span class="co">#&gt; Number of samples: 4104 </span></span>
<span><span class="co">#&gt; Number stomachs: 9660 </span></span>
<span><span class="co">#&gt; Predators: Gadus morhua </span></span>
<span><span class="co">#&gt; Number of prey names: 12 </span></span>
<span><span class="co">#&gt; Years: 1991 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; TRUE:  Changes done</span></span>
<span><span class="co">#&gt; TRUE:  Prey weights by record done</span></span>
<span><span class="co">#&gt; TRUE:  Bias corrected, energy contents, armament etc</span></span>
<span><span class="co">#&gt; TRUE:  Predator size class assigned</span></span>
<span><span class="co">#&gt; TRUE:  Bias corrected, regurgitated stomachs</span></span>
<span><span class="co">#&gt; TRUE:  Prey size class assigned</span></span>
<span><span class="co">#&gt; TRUE:  Aggregate by sample ID and predator and prey size group</span></span>
<span><span class="co">#&gt; FALSE: Temporal and spatial strata added</span></span>
<span><span class="co">#&gt; FALSE: Allocate partly identified prey species</span></span>
<span><span class="co">#&gt; FALSE: Allocate missing prey length</span></span>
<span><span class="fu"><a href="../reference/do_detailed_output.html">do_detailed_output</a></span><span class="op">(</span><span class="va">s</span>, by_sample_id<span class="op">=</span><span class="cn">TRUE</span>,to_screen<span class="op">=</span><span class="cn">TRUE</span>, label<span class="op">=</span><span class="st">"After aggregation"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  After aggregation </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  sample_id: Gadus morhua_SCO_y:91_q:1_ID:582  fish_id: 0500-0699 </span></span>
<span><span class="co">#&gt; Number of stomachs ('n_tot'): 4 </span></span>
<span><span class="co">#&gt;                      0070-0099 0100-0149 0150-0199 0200-0249 0250-0299</span></span>
<span><span class="co">#&gt; Clupea harengus             NA        NA        NA   25852.5        NA</span></span>
<span><span class="co">#&gt; Trisopterus esmarkii        NA    7048.3        NA        NA        NA</span></span>
<span><span class="co">#&gt; all                          0    7048.3         0   25852.5         0</span></span>
<span><span class="co">#&gt;                      9999-9999     all</span></span>
<span><span class="co">#&gt; Clupea harengus             NA 25852.5</span></span>
<span><span class="co">#&gt; Trisopterus esmarkii      10.2  7058.5</span></span>
<span><span class="co">#&gt; all                       10.2 32911.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  sample_id: Gadus morhua_FRA_y:91_q:1_ID:1008  fish_id: 1000-1499 </span></span>
<span><span class="co">#&gt; Number of stomachs ('n_tot'): 1 </span></span>
<span><span class="co">#&gt;                      0070-0099 0100-0149 0150-0199 0200-0249 0250-0299</span></span>
<span><span class="co">#&gt; Clupea harengus             NA        NA        NA   40580.2        NA</span></span>
<span><span class="co">#&gt; Clupeidae                   NA    1376.4        NA        NA        NA</span></span>
<span><span class="co">#&gt; Merlangius merlangus        NA        NA        NA        NA  129775.9</span></span>
<span><span class="co">#&gt; other                       NA        NA        NA        NA        NA</span></span>
<span><span class="co">#&gt; Other fish              7517.7   33238.1  132799.3   42601.9        NA</span></span>
<span><span class="co">#&gt; all                     7517.7   34614.5  132799.3   83182.1  129775.9</span></span>
<span><span class="co">#&gt;                      9999-9999      all</span></span>
<span><span class="co">#&gt; Clupea harengus             NA  40580.2</span></span>
<span><span class="co">#&gt; Clupeidae                   NA   1376.4</span></span>
<span><span class="co">#&gt; Merlangius merlangus        NA 129775.9</span></span>
<span><span class="co">#&gt; other                   7602.2   7602.2</span></span>
<span><span class="co">#&gt; Other fish                  NA 216157.0</span></span>
<span><span class="co">#&gt; all                     7602.2 395491.7</span></span></code></pre></div>
<p>The call to replaces fish_id by the predator size class. In this case
there are are only one fish_id within a sample id, so there is no
changes except the use of predator and prey size classes.</p>
</div>
<div class="section level3">
<h3 id="assigning-strata-first-step-in-estimating-population-diet">Assigning strata, first step in estimating population diet<a class="anchor" aria-label="anchor" href="#assigning-strata-first-step-in-estimating-population-diet"></a>
</h3>
<p>The average diet should basically be calculated as a stratified mean
of the individual stomach content samples, weighted by strata abundances
(indices) of the predator and areas of the strata. In this example an
average stomach contents is first calculate by ICES rectangles. When
there was more than one sample within a rectangle the rectangle value
was calculated as the weighted mean of the sample (haul) average values,
the weighting factors being the number of stomachs from each haul.</p>
<p>The average stomach contents is then calculated for a larger area
which in this case is the ICES roundfish areas consisting of a number of
ICES rectangles. The mean strata_area is a weighted average of the The
rectangle values were weighted by the mean square root of survey catch
rates within the rectangle; this reduces the influence of occasional
very large catch rates.</p>
<p>Finally the population diet is calculated from the average roundfish
stomach contents weighted by the proportion of the predator population
within the roundfish areas.</p>
<p>The temporal stratification is based on year and quarter of the
year.</p>
<p>The stratification is specified in the control object to STOMobs as
shown below</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#structure and default contents</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_control.html">get_control</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span>,show<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Stratification'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; #### group: Stratification</span></span>
<span></span>
<span><span class="va">s</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/edit_control.html">edit_control</a></span><span class="op">(</span><span class="va">s</span>,</span>
<span>     strata_area_exp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'R'</span>,<span class="va">area</span>,sep<span class="op">=</span><span class="st">'-'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     strata_sub_area_exp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">rectangle</span><span class="op">)</span>,</span>
<span>     strata_time_exp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">year</span>, <span class="st">"-Q"</span>, <span class="va">quarter</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     strata_year_back<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">stratum_time</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     strata_quarter_back<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">stratum_time</span>, <span class="fl">7</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="co">#&gt; strata_area_exp type; expression TRUE </span></span>
<span><span class="co">#&gt; strata_sub_area_exp type; expression TRUE </span></span>
<span><span class="co">#&gt; strata_time_exp type; expression TRUE </span></span>
<span><span class="co">#&gt; strata_year_back type; expression TRUE </span></span>
<span><span class="co">#&gt; strata_quarter_back type; expression TRUE</span></span>
<span></span>
<span><span class="co"># to see the changes</span></span>
<span><span class="co"># print(get_control(s),show=c('stratification'))</span></span></code></pre></div>
<p>The “strata_sub_area_exp” is defined from the STOMobs field
rectangle, and the “strata_area” from area (with an “R-” in front). The
“strata_time_exp” is defined from the fields year and quarter. Note that
definition of strata is provided as as R expression. The
“strata_year_back” and “strata_quarter_back” are expression to derive
year and quarter from the strata_time variable (used in Example 4)</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/add_strata.html">add_strata</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/do_detailed_output.html">do_detailed_output</a></span><span class="op">(</span><span class="va">s</span>,label<span class="op">=</span><span class="st">'After add_strata'</span>, by_sample_id<span class="op">=</span><span class="cn">TRUE</span>,to_screen<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  After add_strata </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; stratum_area: R-1 stratum_sub_area: 50E7 stratum_time: 1991-Q1 sample_id: Gadus morhua_SCO_y:91_q:1_ID:582  fish_id: 0500-0699 </span></span>
<span><span class="co">#&gt; Number of stomachs ('n_tot'): 4 </span></span>
<span><span class="co">#&gt;                      0070-0099 0100-0149 0150-0199 0200-0249 0250-0299</span></span>
<span><span class="co">#&gt; Clupea harengus             NA        NA        NA   25852.5        NA</span></span>
<span><span class="co">#&gt; Trisopterus esmarkii        NA    7048.3        NA        NA        NA</span></span>
<span><span class="co">#&gt; all                          0    7048.3         0   25852.5         0</span></span>
<span><span class="co">#&gt;                      9999-9999     all</span></span>
<span><span class="co">#&gt; Clupea harengus             NA 25852.5</span></span>
<span><span class="co">#&gt; Trisopterus esmarkii      10.2  7058.5</span></span>
<span><span class="co">#&gt; all                       10.2 32911.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; stratum_area: R-7 stratum_sub_area: 40F6 stratum_time: 1991-Q1 sample_id: Gadus morhua_FRA_y:91_q:1_ID:1008  fish_id: 1000-1499 </span></span>
<span><span class="co">#&gt; Number of stomachs ('n_tot'): 1 </span></span>
<span><span class="co">#&gt;                      0070-0099 0100-0149 0150-0199 0200-0249 0250-0299</span></span>
<span><span class="co">#&gt; Clupea harengus             NA        NA        NA   40580.2        NA</span></span>
<span><span class="co">#&gt; Clupeidae                   NA    1376.4        NA        NA        NA</span></span>
<span><span class="co">#&gt; Merlangius merlangus        NA        NA        NA        NA  129775.9</span></span>
<span><span class="co">#&gt; other                       NA        NA        NA        NA        NA</span></span>
<span><span class="co">#&gt; Other fish              7517.7   33238.1  132799.3   42601.9        NA</span></span>
<span><span class="co">#&gt; all                     7517.7   34614.5  132799.3   83182.1  129775.9</span></span>
<span><span class="co">#&gt;                      9999-9999      all</span></span>
<span><span class="co">#&gt; Clupea harengus             NA  40580.2</span></span>
<span><span class="co">#&gt; Clupeidae                   NA   1376.4</span></span>
<span><span class="co">#&gt; Merlangius merlangus        NA 129775.9</span></span>
<span><span class="co">#&gt; other                   7602.2   7602.2</span></span>
<span><span class="co">#&gt; Other fish                  NA 216157.0</span></span>
<span><span class="co">#&gt; all                     7602.2 395491.7</span></span>
<span></span>
<span><span class="co"># save data set for use in example 5</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">s</span>,file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span> package <span class="op">=</span> <span class="st">"FishStomachs"</span><span class="op">)</span>,<span class="st">"extdata"</span>,<span class="st">"ex03half.Rdata"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="assigning-partly-identified-prey-items-to-identified-preys-">Assigning partly identified prey items to identified preys.<a class="anchor" aria-label="anchor" href="#assigning-partly-identified-prey-items-to-identified-preys-"></a>
</h3>
<p>Prey items are now named as model preys (named prey from data set
NODC_split) or or the unnamed preys “other”, “other food”, “other fish”,
“Clupeidae”, “Gadidae” and “unknown”. This assigning of partly
identified preys are done using a key (data set “from_to_species.csv
below”) and the function make_from_to_species().</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">from_to</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/make_from_to_species.html">make_from_to_species</a></span><span class="op">(</span>inp_file<span class="op">=</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span> package <span class="op">=</span> <span class="st">"FishStomachs"</span><span class="op">)</span>,<span class="st">"extdata"</span>,<span class="st">"from_to_species.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">from_to</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 15 × 3</span></span></span>
<span><span class="co">#&gt;    order from_species to_species                </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1 Clupeidae    <span style="color: #949494;">"</span>Clupea harengus<span style="color: #949494;">"</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     1 Clupeidae    <span style="color: #949494;">"</span>Sprattus sprattus<span style="color: #949494;">"</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     2 Gadidae      <span style="color: #949494;">"</span>Gadus morhua<span style="color: #949494;">"</span>            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     2 Gadidae      <span style="color: #949494;">"</span>Melanogrammus aeglefinus<span style="color: #949494;">"</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     2 Gadidae      <span style="color: #949494;">"</span>Merlangius merlangus<span style="color: #949494;">"</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     2 Gadidae      <span style="color: #949494;">"</span>Trisopterus esmarkii<span style="color: #949494;">"</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     3 unknown      <span style="color: #949494;">"</span>Ammodytidae<span style="color: #949494;">"</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     3 unknown      <span style="color: #949494;">"</span>Clupea harengus <span style="color: #949494;">"</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     3 unknown      <span style="color: #949494;">"</span>Gadus morhua<span style="color: #949494;">"</span>            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>     3 unknown      <span style="color: #949494;">"</span>Melanogrammus aeglefinus<span style="color: #949494;">"</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>     3 unknown      <span style="color: #949494;">"</span>Merlangius merlangus<span style="color: #949494;">"</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>     3 unknown      <span style="color: #949494;">"</span>other <span style="color: #949494;">"</span>                  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span>     3 unknown      <span style="color: #949494;">"</span>Other fish<span style="color: #949494;">"</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span>     3 unknown      <span style="color: #949494;">"</span>Sprattus sprattus<span style="color: #949494;">"</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span>     3 unknown      <span style="color: #949494;">"</span>Trisopterus esmarkii<span style="color: #949494;">"</span></span></span></code></pre></div>
<p>The from_to data specify that first (order=1) preys identified as the
group “Clupeidae” must be split into the proportionally to the known
prey species <em>Clupea harengus</em> and <em>Sprattus sprattus</em> (if
such are identified in the sample). Next (order=2) “Gadidae” is spilt
into a range of gadoids. As the third step, “unknown” prey item are
split into a range of prey groups, which includes both named and not
named preys. This splitting og preys can be done at different strata
level, starting with sample level, sub_area level and area level.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/do_detailed_output.html">do_detailed_output</a></span><span class="op">(</span><span class="va">s</span>, by_sample_id<span class="op">=</span><span class="cn">TRUE</span>,to_screen<span class="op">=</span><span class="cn">TRUE</span>,use_criteria<span class="op">=</span><span class="cn">FALSE</span>,rel_weight<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>        label<span class="op">=</span><span class="st">"Before reallocation of unindentified preys"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Before reallocation of unindentified preys </span></span>
<span><span class="co">#&gt;                          0050-0069 0070-0099  0100-0149  0150-0199  0200-0249</span></span>
<span><span class="co">#&gt; Ammodytidae               753996.0 1298498.2   869299.9   557346.7   114216.8</span></span>
<span><span class="co">#&gt; Clupea harengus             6988.4   46347.6  1282703.1  3120690.5  8102876.6</span></span>
<span><span class="co">#&gt; Clupeidae                       NA  158177.7   394890.6    11511.6    16863.9</span></span>
<span><span class="co">#&gt; Gadidae                    59773.1  195729.9  1199981.4  1456224.1   893190.7</span></span>
<span><span class="co">#&gt; Gadus morhua               73196.4  346425.0   585600.7   376510.4   133912.1</span></span>
<span><span class="co">#&gt; Melanogrammus aeglefinus        NA  286947.4  2248529.9  1590231.9  2168087.8</span></span>
<span><span class="co">#&gt; Merlangius merlangus       10291.1   77144.0  3029587.3  3278896.3  5747350.4</span></span>
<span><span class="co">#&gt; other                           NA        NA         NA         NA         NA</span></span>
<span><span class="co">#&gt; Other fish                594858.7 2150307.9 14051633.5 19207575.2  5922914.4</span></span>
<span><span class="co">#&gt; Sprattus sprattus           3775.1  355231.4   423696.0         NA         NA</span></span>
<span><span class="co">#&gt; Trisopterus esmarkii      100547.7 1907821.3  7462842.8  2818924.2    41040.3</span></span>
<span><span class="co">#&gt; unknown                         NA        NA         NA         NA         NA</span></span>
<span><span class="co">#&gt; all                      1603426.5 6822630.3 31548765.2 32417910.9 23140453.0</span></span>
<span><span class="co">#&gt;                           0250-0299 0300-0399 0400-0499  9999-9999         all</span></span>
<span><span class="co">#&gt; Ammodytidae                      NA        NA        NA   668877.5   4262235.1</span></span>
<span><span class="co">#&gt; Clupea harengus           3494707.7        NA        NA   938683.5  16992997.2</span></span>
<span><span class="co">#&gt; Clupeidae                        NA        NA        NA   213284.8    794728.7</span></span>
<span><span class="co">#&gt; Gadidae                    335357.5  297563.9        NA   760617.9   5198438.6</span></span>
<span><span class="co">#&gt; Gadus morhua               217406.0  171898.0  656629.5    50367.0   2611944.9</span></span>
<span><span class="co">#&gt; Melanogrammus aeglefinus   447690.7  232673.0  271301.7   298954.5   7544417.0</span></span>
<span><span class="co">#&gt; Merlangius merlangus      5671128.1 1707601.9        NA  1097945.4  20619944.5</span></span>
<span><span class="co">#&gt; other                            NA        NA        NA 21656533.9  21656533.9</span></span>
<span><span class="co">#&gt; Other fish                3153439.2 3460758.2        NA  3375341.3  51916828.3</span></span>
<span><span class="co">#&gt; Sprattus sprattus                NA        NA        NA     3605.1    786307.7</span></span>
<span><span class="co">#&gt; Trisopterus esmarkii             NA        NA        NA   486302.4  12817478.7</span></span>
<span><span class="co">#&gt; unknown                          NA        NA        NA     1286.6      1286.6</span></span>
<span><span class="co">#&gt; all                      13319729.1 5870495.1  927931.2 29551799.8 145203141.1</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="../reference/do_detailed_output.html">do_detailed_output</a></span><span class="op">(</span><span class="va">s</span>, by_sample_id<span class="op">=</span><span class="cn">TRUE</span>,to_screen<span class="op">=</span><span class="cn">TRUE</span>,use_criteria<span class="op">=</span><span class="cn">FALSE</span>,rel_weight<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>        label<span class="op">=</span><span class="st">"Before reallocation of unindentified preys"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Before reallocation of unindentified preys </span></span>
<span><span class="co">#&gt;                          0050-0069 0070-0099 0100-0149 0150-0199 0200-0249</span></span>
<span><span class="co">#&gt; Ammodytidae                    0.5       0.9       0.6       0.4       0.1</span></span>
<span><span class="co">#&gt; Clupea harengus                0.0       0.0       0.9       2.1       5.6</span></span>
<span><span class="co">#&gt; Clupeidae                       NA       0.1       0.3       0.0       0.0</span></span>
<span><span class="co">#&gt; Gadidae                        0.0       0.1       0.8       1.0       0.6</span></span>
<span><span class="co">#&gt; Gadus morhua                   0.1       0.2       0.4       0.3       0.1</span></span>
<span><span class="co">#&gt; Melanogrammus aeglefinus        NA       0.2       1.5       1.1       1.5</span></span>
<span><span class="co">#&gt; Merlangius merlangus           0.0       0.1       2.1       2.3       4.0</span></span>
<span><span class="co">#&gt; other                           NA        NA        NA        NA        NA</span></span>
<span><span class="co">#&gt; Other fish                     0.4       1.5       9.7      13.2       4.1</span></span>
<span><span class="co">#&gt; Sprattus sprattus              0.0       0.2       0.3        NA        NA</span></span>
<span><span class="co">#&gt; Trisopterus esmarkii           0.1       1.3       5.1       1.9       0.0</span></span>
<span><span class="co">#&gt; unknown                         NA        NA        NA        NA        NA</span></span>
<span><span class="co">#&gt; all                            1.1       4.7      21.7      22.3      15.9</span></span>
<span><span class="co">#&gt;                          0250-0299 0300-0399 0400-0499 9999-9999   all</span></span>
<span><span class="co">#&gt; Ammodytidae                     NA        NA        NA       0.5   2.9</span></span>
<span><span class="co">#&gt; Clupea harengus                2.4        NA        NA       0.6  11.7</span></span>
<span><span class="co">#&gt; Clupeidae                       NA        NA        NA       0.1   0.5</span></span>
<span><span class="co">#&gt; Gadidae                        0.2       0.2        NA       0.5   3.6</span></span>
<span><span class="co">#&gt; Gadus morhua                   0.1       0.1       0.5       0.0   1.8</span></span>
<span><span class="co">#&gt; Melanogrammus aeglefinus       0.3       0.2       0.2       0.2   5.2</span></span>
<span><span class="co">#&gt; Merlangius merlangus           3.9       1.2        NA       0.8  14.2</span></span>
<span><span class="co">#&gt; other                           NA        NA        NA      14.9  14.9</span></span>
<span><span class="co">#&gt; Other fish                     2.2       2.4        NA       2.3  35.8</span></span>
<span><span class="co">#&gt; Sprattus sprattus               NA        NA        NA       0.0   0.5</span></span>
<span><span class="co">#&gt; Trisopterus esmarkii            NA        NA        NA       0.3   8.8</span></span>
<span><span class="co">#&gt; unknown                         NA        NA        NA       0.0   0.0</span></span>
<span><span class="co">#&gt; all                            9.2       4.0       0.6      20.4 100.0</span></span>
<span></span>
<span><span class="co"># by sample</span></span>
<span><span class="va">s</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/redist_unidentified_prey_sp.html">redist_unidentified_prey_sp</a></span><span class="op">(</span><span class="va">s</span>,dist_time<span class="op">=</span><span class="va">stratum_time</span>,dist_area<span class="op">=</span><span class="va">sample_id</span>,</span>
<span>        dist_pred_size<span class="op">=</span><span class="va">pred_size</span>, do_only<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,from_to_species<span class="op">=</span><span class="va">from_to</span>,</span>
<span>        by_prey_size<span class="op">=</span><span class="cn">FALSE</span>,remains_to_other <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/do_detailed_output.html">do_detailed_output</a></span><span class="op">(</span><span class="va">s</span>, by_sample_id<span class="op">=</span><span class="cn">TRUE</span>,to_screen<span class="op">=</span><span class="cn">TRUE</span>,use_criteria<span class="op">=</span><span class="cn">FALSE</span>,rel_weight<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>        label<span class="op">=</span><span class="st">"Before reallocation of unindentified preys"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Before reallocation of unindentified preys </span></span>
<span><span class="co">#&gt;                          0050-0069 0070-0099 0100-0149 0150-0199 0200-0249</span></span>
<span><span class="co">#&gt; Ammodytidae                    0.5       0.9       0.6       0.4       0.1</span></span>
<span><span class="co">#&gt; Clupea harengus                0.0       0.0       0.9       2.2       5.6</span></span>
<span><span class="co">#&gt; Clupeidae                       NA        NA        NA        NA        NA</span></span>
<span><span class="co">#&gt; Gadidae                         NA        NA        NA        NA        NA</span></span>
<span><span class="co">#&gt; Gadus morhua                   0.1       0.3       0.5       0.3       0.1</span></span>
<span><span class="co">#&gt; Melanogrammus aeglefinus        NA       0.2       1.7       1.1       1.5</span></span>
<span><span class="co">#&gt; Merlangius merlangus           0.0       0.1       2.2       2.3       4.1</span></span>
<span><span class="co">#&gt; other                           NA        NA        NA        NA        NA</span></span>
<span><span class="co">#&gt; Other fish                     0.4       1.5       9.7      13.2       4.1</span></span>
<span><span class="co">#&gt; Sprattus sprattus              0.0       0.3       0.3        NA        NA</span></span>
<span><span class="co">#&gt; Trisopterus esmarkii           0.1       1.4       5.4       2.0       0.0</span></span>
<span><span class="co">#&gt; unknown                         NA        NA        NA        NA        NA</span></span>
<span><span class="co">#&gt; all                            1.1       4.5      21.2      21.5      15.5</span></span>
<span><span class="co">#&gt;                          0250-0299 0300-0399 0400-0499 9999-9999   all</span></span>
<span><span class="co">#&gt; Ammodytidae                     NA        NA        NA       0.5   2.9</span></span>
<span><span class="co">#&gt; Clupea harengus                2.4        NA        NA       0.6  11.7</span></span>
<span><span class="co">#&gt; Clupeidae                       NA        NA        NA       0.5   0.5</span></span>
<span><span class="co">#&gt; Gadidae                         NA        NA        NA       2.3   2.3</span></span>
<span><span class="co">#&gt; Gadus morhua                   0.1       0.1       0.5       0.0   1.9</span></span>
<span><span class="co">#&gt; Melanogrammus aeglefinus       0.3       0.2       0.2       0.2   5.4</span></span>
<span><span class="co">#&gt; Merlangius merlangus           4.0       1.2        NA       0.9  14.7</span></span>
<span><span class="co">#&gt; other                           NA        NA        NA      14.9  14.9</span></span>
<span><span class="co">#&gt; Other fish                     2.2       2.4        NA       2.3  35.8</span></span>
<span><span class="co">#&gt; Sprattus sprattus               NA        NA        NA       0.0   0.5</span></span>
<span><span class="co">#&gt; Trisopterus esmarkii            NA        NA        NA       0.4   9.2</span></span>
<span><span class="co">#&gt; unknown                         NA        NA        NA       0.0   0.0</span></span>
<span><span class="co">#&gt; all                            9.0       3.9       0.6      22.7 100.0</span></span></code></pre></div>
<p>The call to do_detailed_output() is changed such that it shows the
full data set (use_criteria=FALSE), all data are aggregated irrespective
of predator size and year and quarter ( by_sample_id=TRUE). This setting
makes limited sense, however it is made just to follow what happens.</p>
<p>The call to redist_unidentified_prey_sp() is quite complex, so please
see help (?redist_unidentified_prey_sp).</p>
<p>The function redistribute partly identified preys to the distribution
of the identified prey species from the same predator and predator size.
The distribution key is made from an extract of data, which are filtered
by the parameters dist_time, dist_area and dist_pred_size. In this
example, a unique re-distribution key is made by each combination of
stratum_time (year quarter combination), sample_id and predator size
class. The by_prey_size=FALSE specifies that prey sizes is not used in
the stratification, e.g. a Clupeida size 9999-9999 can be re-distributed
to <em>Clupea harengus</em> with known sizes. The do_only=c(1,2)
specifies that is only step number 1 and 2 in the from_to that should
performed (i.e just redistribution of Clupeidae and Gadidae).</p>
<p>The messages from the redist_unidentified_prey_sp() say that 63
records with prey=Clupeidae were found, of which 32 could be reallocated
to named Clupeidae species within tha sample, but there are still 63
records where no named Clupeidae species within the sample. The
unallocated records are kept as they were as parameter remains_to_other
= FALSE. If set to TRUE, the remaining records would have been changed
into “other”.</p>
<p>Before the redistribution, there was Gadidae comprised 3.6 % of the
total stomach contents weight. This is reduced to 2.3 % after the
redistribution, while the stomach contents of the named Gadidae
(<em>Gadus morhua</em>, <em>Melanogrammus aeglefinus</em>,
<em>Merlangius merlangus</em>, <em>Trisopterus esmarkii</em>) have
increased slightly.</p>
<p>The next calls to redist_unidentified_prey_sp() show how to widen the
selection of data to make the allocation key from at sample level
(previous example), to all samples within the rectangle, all samples
within the roundfish area, and the full area of all samples. The last
call make the allocation key from data by year and half year, whereas
the previous calls used data by year and quarter, as that is the used
temporal stratification use in data.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># by sub_area (rectangel)                                                         </span></span>
<span><span class="va">s</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/redist_unidentified_prey_sp.html">redist_unidentified_prey_sp</a></span><span class="op">(</span><span class="va">s</span>,dist_time<span class="op">=</span><span class="va">stratum_time</span>,dist_area<span class="op">=</span><span class="va">stratum_sub_area</span>,</span>
<span>        dist_pred_size<span class="op">=</span><span class="va">pred_size</span>, do_only<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,from_to_species<span class="op">=</span><span class="va">from_to</span>,</span>
<span>        by_prey_size<span class="op">=</span><span class="cn">FALSE</span>,remains_to_other <span class="op">=</span> <span class="cn">FALSE</span>, verbose<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Redist.  Clupeidae  Records to be dis.: 63,  found: 31   </span></span>
<span><span class="co">#&gt; Redist.  Gadidae  Records to be dis.: 222,  found: 83</span></span>
<span></span>
<span><span class="co"># by area (=roundfish area)                                                               </span></span>
<span><span class="va">s</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/redist_unidentified_prey_sp.html">redist_unidentified_prey_sp</a></span><span class="op">(</span><span class="va">s</span>,dist_time<span class="op">=</span><span class="va">stratum_time</span>,dist_area<span class="op">=</span><span class="va">stratum_area</span>,</span>
<span>        dist_pred_size<span class="op">=</span><span class="va">pred_size</span>, do_only<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>,from_to_species<span class="op">=</span><span class="va">from_to</span>,</span>
<span>        by_prey_size<span class="op">=</span><span class="cn">FALSE</span>,remains_to_other <span class="op">=</span> <span class="cn">FALSE</span>, verbose<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Redist.  Clupeidae  Records to be dis.: 32,  found: 28   </span></span>
<span><span class="co">#&gt; Redist.  Gadidae  Records to be dis.: 139,  found: 118   </span></span>
<span><span class="co">#&gt; Redist.  unknown  Records to be dis.: 5,  found: 4</span></span>
<span></span>
<span><span class="co"># all areas                                                               </span></span>
<span><span class="va">s</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/redist_unidentified_prey_sp.html">redist_unidentified_prey_sp</a></span><span class="op">(</span><span class="va">s</span>,dist_time<span class="op">=</span><span class="va">stratum_time</span>,dist_area<span class="op">=</span><span class="st">'All'</span>,</span>
<span>        dist_pred_size<span class="op">=</span><span class="va">pred_size</span>, do_only<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>,from_to_species<span class="op">=</span><span class="va">from_to</span>,</span>
<span>        by_prey_size<span class="op">=</span><span class="cn">FALSE</span>,remains_to_other <span class="op">=</span> <span class="cn">FALSE</span>, verbose<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Redist.  Clupeidae  Records to be dis.: 4,  found: 4   </span></span>
<span><span class="co">#&gt; Redist.  Gadidae  Records to be dis.: 21,  found: 14   </span></span>
<span><span class="co">#&gt; Redist.  unknown  Records to be dis.: 1,  found: 1</span></span>
<span></span>
<span></span>
<span><span class="co"># all areas and half-year (dist_time is changed)                                                             </span></span>
<span><span class="va">s</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/redist_unidentified_prey_sp.html">redist_unidentified_prey_sp</a></span><span class="op">(</span><span class="va">s</span>,dist_time<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">year</span>,<span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">quarter</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,<span class="st">'S1'</span>,<span class="st">'S2'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        dist_area<span class="op">=</span><span class="st">'All'</span>,dist_pred_size<span class="op">=</span><span class="va">pred_size</span>, do_only<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>,from_to_species<span class="op">=</span><span class="va">from_to</span>,</span>
<span>        by_prey_size<span class="op">=</span><span class="cn">FALSE</span>,remains_to_other <span class="op">=</span> <span class="cn">FALSE</span>, verbose<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Redist.  Clupeidae  Records to be dis.: 0</span></span>
<span><span class="co">#&gt; Redist.  Gadidae  Records to be dis.: 7,  found: 6   </span></span>
<span><span class="co">#&gt; Redist.  unknown  Records to be dis.: 0</span></span></code></pre></div>
<p>There is still one occurrence of “Gadidae” that cannot be
redistributed.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span>,<span class="va">prey_name</span><span class="op">==</span><span class="st">'Gadidae'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   dataset country ship rectangle area year quarter month day station haul</span></span>
<span><span class="co">#&gt; 1      NS     GFR WAL2      43F5    7 1991       2     5  24     446  446</span></span>
<span><span class="co">#&gt;                           sample_id    pred_name  pred_nodc   box17</span></span>
<span><span class="co">#&gt; 1 Gadus morhua_GFR_y:91_q:2_ID:1109 Gadus morhua 8791030402 outside</span></span>
<span><span class="co">#&gt;   pred_size_class pred_size n_tot pred_l_mean   fish_id stratum_time</span></span>
<span><span class="co">#&gt; 1               4 0150-0199    11         175 0150-0199      1991-Q2</span></span>
<span><span class="co">#&gt;   stratum_area stratum_sub_area prey_name digest prey_size_class prey_size</span></span>
<span><span class="co">#&gt; 1          R-7             43F5   Gadidae      1               0 9999-9999</span></span>
<span><span class="co">#&gt;     prey_w prey_l_mean   prey_n</span></span>
<span><span class="co">#&gt; 1 120.6469          38 1.166667</span></span></code></pre></div>
<p>The problem seems to be a small cod (0150-0199) which has eaten
“Gadidae”. Other cod within the same size class have not eaten named
Gadidae (e.g. cod or whiting), so it is not possible to make a
distribution key for the that size class. In this case this Gadidae is
turned into “other food” in the next call to
redist_unidentified_prey_sp().</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># the same as above, but unallocated remains to "other food".                                                             </span></span>
<span><span class="va">s</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/redist_unidentified_prey_sp.html">redist_unidentified_prey_sp</a></span><span class="op">(</span><span class="va">s</span>,dist_time<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">year</span>,<span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">quarter</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,<span class="st">'S1'</span>,<span class="st">'S2'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        dist_area<span class="op">=</span><span class="st">'All'</span>,dist_pred_size<span class="op">=</span><span class="va">pred_size</span>, do_only<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>,from_to_species<span class="op">=</span><span class="va">from_to</span>,</span>
<span>        by_prey_size<span class="op">=</span><span class="cn">FALSE</span>,remains_to_other <span class="op">=</span> <span class="cn">TRUE</span>, verbose<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Redist.  Clupeidae  Records to be dis.: 0</span></span>
<span><span class="co">#&gt; Redist.  Gadidae  Records to be dis.: 1,  found: 0   as other: 1</span></span>
<span><span class="co">#&gt; Redist.  unknown  Records to be dis.: 0</span></span>
<span></span>
<span><span class="fu"><a href="../reference/do_detailed_output.html">do_detailed_output</a></span><span class="op">(</span><span class="va">s</span>, by_sample_id<span class="op">=</span><span class="cn">TRUE</span>,to_screen<span class="op">=</span><span class="cn">TRUE</span>,use_criteria<span class="op">=</span><span class="cn">FALSE</span>,rel_weight<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>        label<span class="op">=</span><span class="st">"After reallocation of unindentified preys"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  After reallocation of unindentified preys </span></span>
<span><span class="co">#&gt;                          0050-0069 0070-0099 0100-0149 0150-0199 0200-0249</span></span>
<span><span class="co">#&gt; Ammodytidae                    0.5       0.9       0.6       0.4       0.1</span></span>
<span><span class="co">#&gt; Clupea harengus                0.0       0.0       0.9       2.2       5.7</span></span>
<span><span class="co">#&gt; Gadus morhua                   0.1       0.3       0.6       0.3       0.1</span></span>
<span><span class="co">#&gt; Melanogrammus aeglefinus        NA       0.2       1.8       1.2       1.6</span></span>
<span><span class="co">#&gt; Merlangius merlangus           0.0       0.1       2.5       2.5       4.2</span></span>
<span><span class="co">#&gt; other                           NA        NA        NA        NA        NA</span></span>
<span><span class="co">#&gt; Other fish                     0.4       1.5       9.7      13.2       4.1</span></span>
<span><span class="co">#&gt; Sprattus sprattus              0.0       0.3       0.4        NA        NA</span></span>
<span><span class="co">#&gt; Trisopterus esmarkii           0.1       1.4       5.9       2.1       0.0</span></span>
<span><span class="co">#&gt; all                            1.1       4.7      22.3      21.9      15.9</span></span>
<span><span class="co">#&gt;                          0250-0299 0300-0399 0400-0499 9999-9999   all</span></span>
<span><span class="co">#&gt; Ammodytidae                     NA        NA        NA       0.5   2.9</span></span>
<span><span class="co">#&gt; Clupea harengus                2.4        NA        NA       0.8  12.1</span></span>
<span><span class="co">#&gt; Gadus morhua                   0.2       0.1       0.5       0.0   2.0</span></span>
<span><span class="co">#&gt; Melanogrammus aeglefinus       0.5       0.2       0.2       0.2   5.8</span></span>
<span><span class="co">#&gt; Merlangius merlangus           4.1       1.3        NA       1.1  15.7</span></span>
<span><span class="co">#&gt; other                           NA        NA        NA      14.9  14.9</span></span>
<span><span class="co">#&gt; Other fish                     2.2       2.4        NA       2.3  35.8</span></span>
<span><span class="co">#&gt; Sprattus sprattus               NA        NA        NA       0.0   0.7</span></span>
<span><span class="co">#&gt; Trisopterus esmarkii            NA        NA        NA       0.4  10.1</span></span>
<span><span class="co">#&gt; all                            9.3       3.9       0.6      20.2 100.0</span></span></code></pre></div>
<p>After the allocation of preys, data now includes the named species
(for later use in models) and the groups “other” and “other fish” that
will be converted to “other food” later. There are however still named
preys with unknown size (9999-9999) that need to allocated to known
sizes.</p>
</div>
<div class="section level3">
<h3 id="assigning-size-classes-where-missing">Assigning size classes where missing<a class="anchor" aria-label="anchor" href="#assigning-size-classes-where-missing"></a>
</h3>
<p>The assigning of size classes where missing is done in a similar way
as the allocation of species name to partly identified prey items, but
using the function redist_unidentifed_prey_lengths(). This function only
works for the species provided by sel_preys in the control object</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># a very complex way of getting a list of prey names!</span></span>
<span><span class="va">keep_prey</span> <span class="op">&lt;-</span><span class="op">(</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span> package <span class="op">=</span> <span class="st">"FishStomachs"</span><span class="op">)</span>,<span class="st">"extdata"</span>,<span class="st">"species_info.csv"</span><span class="op">)</span>,</span>
<span>        col_types <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html" class="external-link">cols</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>  <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">prey_sp</span><span class="op">)</span>  <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">species</span></span>
<span><span class="va">keep_prey</span> <span class="co">#input is just a vector of prey names</span></span>
<span><span class="co">#&gt; [1] "Gadus morhua"             "Merlangius merlangus"    </span></span>
<span><span class="co">#&gt; [3] "Melanogrammus aeglefinus" "Clupea harengus"         </span></span>
<span><span class="co">#&gt; [5] "Ammodytidae"              "Trisopterus esmarkii"    </span></span>
<span><span class="co">#&gt; [7] "Sprattus sprattus"</span></span>
<span></span>
<span><span class="va">s</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/edit_control.html">edit_control</a></span><span class="op">(</span><span class="va">s</span>,sel_preys<span class="op">=</span><span class="va">keep_prey</span><span class="op">)</span></span>
<span><span class="co">#&gt; sel_preys type; vector TRUE</span></span></code></pre></div>
<p>We can now do the re-allocation of missing size classes.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># by statum_area (=roundfish area) </span></span>
<span><span class="va">s</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/redist_unidentified_prey_lengths.html">redist_unidentified_prey_lengths</a></span><span class="op">(</span><span class="va">s</span>,dist_time<span class="op">=</span><span class="va">stratum_time</span>,dist_area<span class="op">=</span><span class="va">stratum_area</span>,</span>
<span>      dist_pred_size<span class="op">=</span><span class="va">pred_size</span>,</span>
<span>      remains_to_other <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># do not add records with missing length allocation to "other food"</span></span>
<span>      others_to_other<span class="op">=</span><span class="cn">TRUE</span>,      <span class="co"># do add other species that selected prey species to "other food"</span></span>
<span>      verbose<span class="op">=</span><span class="cn">TRUE</span></span>
<span>      <span class="op">)</span></span>
<span><span class="co">#&gt; Prey size will be allocated for species: Gadus morhua ,  Merlangius merlangus ,  Melanogrammus aeglefinus ,  Clupea harengus ,  Ammodytidae ,  Trisopterus esmarkii ,  Sprattus sprattus ,  </span></span>
<span><span class="co">#&gt; Records to be distributed: 860 ,  found: 799   Un-allocated: 61</span></span>
<span></span>
<span><span class="co"># within all areas                                                     </span></span>
<span><span class="va">s</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/redist_unidentified_prey_lengths.html">redist_unidentified_prey_lengths</a></span><span class="op">(</span><span class="va">s</span>,dist_time<span class="op">=</span><span class="va">stratum_time</span>,dist_area<span class="op">=</span><span class="st">'All'</span>,</span>
<span>      dist_pred_size<span class="op">=</span><span class="va">pred_size</span>,remains_to_other <span class="op">=</span> <span class="cn">FALSE</span>, verbose<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Prey size will be allocated for species: Gadus morhua ,  Merlangius merlangus ,  Melanogrammus aeglefinus ,  Clupea harengus ,  Ammodytidae ,  Trisopterus esmarkii ,  Sprattus sprattus ,  </span></span>
<span><span class="co">#&gt; Records to be distributed: 61 ,  found: 55   Un-allocated: 6</span></span>
<span></span>
<span><span class="co">#  within all areas, and year (ignoring quarter)                                                   </span></span>
<span><span class="va">s</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/redist_unidentified_prey_lengths.html">redist_unidentified_prey_lengths</a></span><span class="op">(</span>s<span class="op">=</span><span class="va">s</span>,dist_time<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">stratum_time</span>,<span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span>,dist_area<span class="op">=</span><span class="st">'All'</span>,</span>
<span>      dist_pred_size<span class="op">=</span><span class="va">pred_size</span>,remains_to_other <span class="op">=</span> <span class="cn">FALSE</span>, verbose<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Prey size will be allocated for species: Gadus morhua ,  Merlangius merlangus ,  Melanogrammus aeglefinus ,  Clupea harengus ,  Ammodytidae ,  Trisopterus esmarkii ,  Sprattus sprattus ,  </span></span>
<span><span class="co">#&gt; Records to be distributed: 6 ,  found: 3   Un-allocated: 3</span></span>
<span></span>
<span><span class="co"># as above, but with conversion of unallocated into "other"</span></span>
<span><span class="va">s</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/redist_unidentified_prey_lengths.html">redist_unidentified_prey_lengths</a></span><span class="op">(</span>s<span class="op">=</span><span class="va">s</span>,dist_time<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">stratum_time</span>,<span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span>,dist_area<span class="op">=</span><span class="st">'All'</span>,</span>
<span>      dist_pred_size<span class="op">=</span><span class="va">pred_size</span>,remains_to_other <span class="op">=</span> <span class="cn">TRUE</span>, verbose<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Prey size will be allocated for species: Gadus morhua ,  Merlangius merlangus ,  Melanogrammus aeglefinus ,  Clupea harengus ,  Ammodytidae ,  Trisopterus esmarkii ,  Sprattus sprattus ,  </span></span>
<span><span class="co">#&gt; Records to be distributed: 3 ,  found: 0   Un-allocated: 3</span></span>
<span></span>
<span><span class="fu"><a href="../reference/do_detailed_output.html">do_detailed_output</a></span><span class="op">(</span><span class="va">s</span>, by_sample_id<span class="op">=</span><span class="cn">TRUE</span>,to_screen<span class="op">=</span><span class="cn">TRUE</span>,use_criteria<span class="op">=</span><span class="cn">FALSE</span>,rel_weight<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;                          0050-0069 0070-0099 0100-0149 0150-0199 0200-0249</span></span>
<span><span class="co">#&gt; Ammodytidae                    0.6       1.1       0.7       0.4       0.1</span></span>
<span><span class="co">#&gt; Clupea harengus                0.0       0.0       0.9       2.4       6.1</span></span>
<span><span class="co">#&gt; Gadus morhua                   0.1       0.3       0.6       0.3       0.1</span></span>
<span><span class="co">#&gt; Melanogrammus aeglefinus        NA       0.2       1.9       1.2       1.6</span></span>
<span><span class="co">#&gt; Merlangius merlangus           0.0       0.1       2.6       2.7       4.6</span></span>
<span><span class="co">#&gt; other                           NA        NA        NA        NA        NA</span></span>
<span><span class="co">#&gt; Sprattus sprattus              0.0       0.3       0.4        NA        NA</span></span>
<span><span class="co">#&gt; Trisopterus esmarkii           0.1       1.5       6.2       2.2       0.0</span></span>
<span><span class="co">#&gt; all                            0.8       3.5      13.4       9.3      12.6</span></span>
<span><span class="co">#&gt;                          0250-0299 0300-0399 0400-0499 9999-9999   all</span></span>
<span><span class="co">#&gt; Ammodytidae                     NA        NA        NA        NA   2.9</span></span>
<span><span class="co">#&gt; Clupea harengus                2.7        NA        NA        NA  12.1</span></span>
<span><span class="co">#&gt; Gadus morhua                   0.2       0.1       0.5        NA   2.0</span></span>
<span><span class="co">#&gt; Melanogrammus aeglefinus       0.5       0.2       0.2        NA   5.8</span></span>
<span><span class="co">#&gt; Merlangius merlangus           4.3       1.4        NA        NA  15.7</span></span>
<span><span class="co">#&gt; other                           NA        NA        NA      50.7  50.7</span></span>
<span><span class="co">#&gt; Sprattus sprattus               NA        NA        NA        NA   0.7</span></span>
<span><span class="co">#&gt; Trisopterus esmarkii            NA        NA        NA        NA  10.1</span></span>
<span><span class="co">#&gt; all                            7.5       1.7       0.6      50.7 100.0</span></span></code></pre></div>
<p>There were a very small amount of <em>Merlangius merlangus</em> that
could not be allocated, and these are allocated into “other” in the last
function call. The prey species are now the selected ones and
“other”.</p>
</div>
<div class="section level3">
<h3 id="calculating-population-diet">Calculating population diet<a class="anchor" aria-label="anchor" href="#calculating-population-diet"></a>
</h3>
<p>The average diet should basically be calculated as a stratified mean
of the individual stomach content samples, weighted by strata abundances
(e.g survey cpue indices) of the predator and strata areas. FishStomachs
uses three strata (ii-iv) in the calculation of population diet:</p>
<ol style="list-style-type: lower-roman">
<li>Sample level. stomach from the same sample (i.e. location and time).
The average stomach contents at that level have been calculated in the
previous examples</li>
<li>Sub-area level. ICES statistical rectangles have been used as
sub-area strata. The average diet within a sub-area is in this example
calculated as a weighted mean (weighted by the number of stomachs).</li>
<li>Area level. ICES roundfish areas are used for area strata. Average
diet within an area is calculated a as weighted mean, weighted by the
predator survey mean cpue by the sub-area (ICES rectangle)</li>
<li>Population. The average population diet is calculated from diet by
are weighted by the extend of the ambient area of the area (e.g. number
of ICES rectangles within a roundfish area)</li>
</ol>
<p>The method for calculating the population is specified with options
in the control object as shown below.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">s</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/edit_control.html">edit_control</a></span><span class="op">(</span><span class="va">s</span>,</span>
<span>        calc_sub_strata<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          <span class="co"># transform into relative weight before data are compiled</span></span>
<span>          relative_weight<span class="op">=</span><span class="cn">FALSE</span>,      </span>
<span>          <span class="co"># use number of stomach in the sample as weighting factor</span></span>
<span>          weighting_factor<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">n_tot</span><span class="op">)</span>,</span>
<span>          <span class="co"># set file to NA when weighting_factor is given</span></span>
<span>          weighting_factor_file<span class="op">=</span><span class="cn">NA</span></span>
<span>        <span class="op">)</span>,</span>
<span>        calc_strata<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          relative_weight<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>          weighting_factor<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">mean_cpue</span><span class="op">)</span><span class="op">)</span>,</span>
<span>          weighting_factor_file<span class="op">=</span><span class="cn">NA</span></span>
<span>        <span class="op">)</span>,</span>
<span>        calc_total<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          relative_weight<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>          <span class="co"># set to NA when input is provided in a file</span></span>
<span>          weighting_factor<span class="op">=</span><span class="cn">NA</span>,</span>
<span>          <span class="co"># use data from a specified file (in those case, a file provided by the FishStomachs)</span></span>
<span>          weighting_factor_file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span> package <span class="op">=</span> <span class="st">"FishStomachs"</span><span class="op">)</span>,<span class="st">"extdata"</span>,<span class="st">"weighting_total.csv"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; calc_sub_strata type; list TRUE </span></span>
<span><span class="co">#&gt; calc_strata type; list TRUE </span></span>
<span><span class="co">#&gt; calc_total type; list TRUE</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">s</span>,<span class="st">"control"</span><span class="op">)</span>,show<span class="op">=</span><span class="st">'calc_diet'</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; #### group: calc_diet </span></span>
<span><span class="co">#&gt; sel_preys:  chr [1:7] "Gadus morhua" "Merlangius merlangus" "Melanogrammus aeglefinus" ...</span></span>
<span><span class="co">#&gt; min_prey_length:  int 50</span></span>
<span><span class="co">#&gt; calc_sub_strata: List of 3</span></span>
<span><span class="co">#&gt;  $ relative_weight      : logi FALSE</span></span>
<span><span class="co">#&gt;  $ weighting_factor     :  expression(n_tot)</span></span>
<span><span class="co">#&gt;  $ weighting_factor_file: logi NA</span></span>
<span><span class="co">#&gt; calc_strata: List of 3</span></span>
<span><span class="co">#&gt;  $ relative_weight      : logi FALSE</span></span>
<span><span class="co">#&gt;  $ weighting_factor     :  expression(sqrt(mean_cpue))</span></span>
<span><span class="co">#&gt;  $ weighting_factor_file: logi NA</span></span>
<span><span class="co">#&gt; calc_total: List of 3</span></span>
<span><span class="co">#&gt;  $ relative_weight      : logi FALSE</span></span>
<span><span class="co">#&gt;  $ weighting_factor     : logi NA</span></span>
<span><span class="co">#&gt;  $ weighting_factor_file: chr "/tmp/Rtmpv4RwBU/temp_libpath5b021b277167/FishStomachs/extdata/weighting_total.csv"</span></span>
<span></span>
<span><span class="co"># information from the group constants in the control object is also used.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">s</span>,<span class="st">"control"</span><span class="op">)</span>,show<span class="op">=</span><span class="st">'constants'</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; #### group: constants </span></span>
<span><span class="co">#&gt; max_l:  int 9999</span></span>
<span><span class="co">#&gt; mis_l:  int 9999</span></span>
<span><span class="co">#&gt; mis_digest:  int 9</span></span>
<span><span class="co">#&gt; other:  chr "other"</span></span>
<span><span class="co">#&gt; mis_size_class:  int 0</span></span></code></pre></div>
<p>For each of the three strata, it must be specified whether the
absolute or relative weight of the diet by strata should be used to
calculate the weighted mean. The weighting factor for the for the
weighted mean must either be given as an expression wit R codes for
variables within the STOMobs object or provided as input from a csv
file. In this case the weighting factor used to calculate average diet
per sub-area is the number of stomachs (n-tot) within each sample. The
average diet at strata level uses the mean cpue variable within the
STOMobs object. Finally the population diet is calculated from average
diet by strata weighted by input values from a file. This file must
contain a weighting factor ( w_fac_area) for each combination of
predator name (pred_name), temporal strata (stratum_time), predator size
class (pred_size) and name of the area (stratum_area). If input from
files are used, it is possible to select combinations of areas and
sub-areas that should be included, as only stomach data that have a
match in weighing files are used in the calculation.</p>
<p>The input files for stratification can be made from a call to
make_template_strata_weighting() using data and its control object. The
call makes a csv file (if write_CSV=TRUE) and return a data set with the
template for stratification at the strata level specified.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">s</span>,<span class="st">"control"</span><span class="op">)</span>,show<span class="op">=</span><span class="st">'calc_diet'</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; #### group: calc_diet </span></span>
<span><span class="co">#&gt; sel_preys:  chr [1:7] "Gadus morhua" "Merlangius merlangus" "Melanogrammus aeglefinus" ...</span></span>
<span><span class="co">#&gt; min_prey_length:  int 50</span></span>
<span><span class="co">#&gt; calc_sub_strata: List of 3</span></span>
<span><span class="co">#&gt;  $ relative_weight      : logi FALSE</span></span>
<span><span class="co">#&gt;  $ weighting_factor     :  expression(n_tot)</span></span>
<span><span class="co">#&gt;  $ weighting_factor_file: logi NA</span></span>
<span><span class="co">#&gt; calc_strata: List of 3</span></span>
<span><span class="co">#&gt;  $ relative_weight      : logi FALSE</span></span>
<span><span class="co">#&gt;  $ weighting_factor     :  expression(sqrt(mean_cpue))</span></span>
<span><span class="co">#&gt;  $ weighting_factor_file: logi NA</span></span>
<span><span class="co">#&gt; calc_total: List of 3</span></span>
<span><span class="co">#&gt;  $ relative_weight      : logi FALSE</span></span>
<span><span class="co">#&gt;  $ weighting_factor     : logi NA</span></span>
<span><span class="co">#&gt;  $ weighting_factor_file: chr "/tmp/Rtmpv4RwBU/temp_libpath5b021b277167/FishStomachs/extdata/weighting_total.csv"</span></span>
<span><span class="fu"><a href="../reference/make_template_strata_weighting.html">make_template_strata_weighting</a></span><span class="op">(</span><span class="va">s</span>,strata<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'sub_strata'</span>,<span class="st">'strata'</span>,<span class="st">'total'</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,write_CSV<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># to show the contents of stratification file as created above (with write_CSV=TRUE)</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span> package <span class="op">=</span> <span class="st">"FishStomachs"</span><span class="op">)</span>,<span class="st">"extdata"</span>,<span class="st">"weighting_total.csv"</span><span class="op">)</span>,show_col_types<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 239 × 5</span></span></span>
<span><span class="co">#&gt;    pred_name    stratum_time pred_size stratum_area w_fac_area</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Gadus morhua 1991-Q1      0200-0249 R-7                   1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Gadus morhua 1991-Q1      0200-0249 R-6                   1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Gadus morhua 1991-Q1      0250-0299 R-4                   1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Gadus morhua 1991-Q1      0250-0299 R-6                   1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Gadus morhua 1991-Q1      0100-0149 R-7                   1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Gadus morhua 1991-Q1      0300-0399 R-4                   1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Gadus morhua 1991-Q1      0300-0399 R-6                   1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Gadus morhua 1991-Q1      0100-0149 R-6                   1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Gadus morhua 1991-Q1      0300-0399 R-7                   1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Gadus morhua 1991-Q1      0300-0399 R-2                   1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 229 more rows</span></span></span></code></pre></div>
<p>Now it is just to call the estimate population diet function.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/calc_population_stom.html">calc_population_stom</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span></span>
<span><span class="va">d</span></span>
<span><span class="co">#&gt; Object of class 'STOMdiet'</span></span>
<span><span class="co">#&gt; ===========================</span></span>
<span><span class="co">#&gt; Number stomachs: 9660 </span></span>
<span><span class="co">#&gt; Predators: Gadus morhua </span></span>
<span><span class="co">#&gt; Number of prey names: 8 </span></span>
<span><span class="co">#&gt; Prey names:Ammodytidae; Clupea harengus; Gadus morhua; Melanogrammus aeglefinus; </span></span>
<span><span class="co">#&gt;     Merlangius merlangus; Sprattus sprattus; Trisopterus esmarkii; other; </span></span>
<span><span class="co">#&gt; Temporal strata: 1991-Q1;  1991-Q2;  1991-Q3;  1991-Q4;</span></span></code></pre></div>
<p>The population diet is store in an object of class STOMdiet - more
details in the next example.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Morten Vinther.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
