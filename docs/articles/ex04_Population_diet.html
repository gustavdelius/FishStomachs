<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Example 04: Population diet • FishStomachs</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Example 04: Population diet">
<meta property="og:description" content="FishStomachs">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FishStomachs</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/FishStomachs.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ex01_Read_and_manipulate_data.html">example 01: Read and manipulate data</a>
    </li>
    <li>
      <a href="../articles/ex02_More_data_manipulations.html">Example 02: More data manipulations</a>
    </li>
    <li>
      <a href="../articles/ex03_Estimate_population_diet.html">Example 03: Estimate population diet</a>
    </li>
    <li>
      <a href="../articles/ex04_Population_diet.html">Example 04: Population diet</a>
    </li>
    <li>
      <a href="../articles/ex05_Create_data_for_model.html">Example 05:Create data for model</a>
    </li>
    <li>
      <a href="../articles/ex06_Bootstrapping.html">Example 06 Bootstrapping</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Example 04: Population diet</h1>
            
      
      
      <div class="hidden name"><code>ex04_Population_diet.Rmd</code></div>

    </div>

    
    
<p>The population diet (estimated in Example 03) is organised as an
object of the class STOMdiet, which is basically a list of predator and
prey related information. The attributes to a STOMdiet (the control
object) includes information on the compilation of data.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">FishStomachs</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span> package <span class="op">=</span> <span class="st">"FishStomachs"</span><span class="op">)</span>,<span class="st">"extdata"</span>,<span class="st">"ex03d.Rdata"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">d</span></span>
<span><span class="co">#&gt; Object of class 'STOMdiet'</span></span>
<span><span class="co">#&gt; ===========================</span></span>
<span><span class="co">#&gt; Number stomachs: 9660 </span></span>
<span><span class="co">#&gt; Predators: Gadus morhua </span></span>
<span><span class="co">#&gt; Number of prey names: 8 </span></span>
<span><span class="co">#&gt; Prey names:Ammodytidae; Clupea harengus; Gadus morhua; Melanogrammus aeglefinus; </span></span>
<span><span class="co">#&gt;     Merlangius merlangus; Sprattus sprattus; Trisopterus esmarkii; other; </span></span>
<span><span class="co">#&gt; Temporal strata: 1991-Q1;  1991-Q2;  1991-Q3;  1991-Q4;</span></span>
<span></span>
<span><span class="va">d</span><span class="op">[[</span><span class="st">'PRED'</span><span class="op">]</span><span class="op">]</span>  <span class="co"># predator related information</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 36 × 9</span></span></span>
<span><span class="co">#&gt;    stratum_area stratum_time pred_…¹ pred_…² pred_…³ n_tot n_sam…⁴ pred_…⁵ key  </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> all          1991-Q1      Gadus … 0100-0…       3    42      18    135  all_…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> all          1991-Q1      Gadus … 0150-0…       4   117      51    175  all_…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> all          1991-Q1      Gadus … 0200-0…       5   123      56    225  all_…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> all          1991-Q1      Gadus … 0250-0…       6    61      29    275  all_…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> all          1991-Q1      Gadus … 0300-0…       7   379     128    361. all_…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> all          1991-Q1      Gadus … 0400-0…       8   327     122    450  all_…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> all          1991-Q1      Gadus … 0500-0…       9   610     301    588. all_…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> all          1991-Q1      Gadus … 0700-0…      10   444     238    840. all_…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> all          1991-Q1      Gadus … 1000-1…      11    84      62   <span style="text-decoration: underline;">1</span>104. all_…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> all          1991-Q2      Gadus … 0100-0…       3     6       6    135  all_…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 26 more rows, and abbreviated variable names ¹​pred_name, ²​pred_size,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ³​pred_size_class, ⁴​n_sample, ⁵​pred_l_mean</span></span></span>
<span><span class="va">d</span><span class="op">[[</span><span class="st">'PREY'</span><span class="op">]</span><span class="op">]</span>  <span class="co"># prey related information</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 469 × 5</span></span></span>
<span><span class="co">#&gt;    key                                prey_name         prey_s…¹ prey_…²  prey_w</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>                              <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> all_Gadus morhua_1991-Q1_0100-0149 other             9999-99…       0 349.   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> all_Gadus morhua_1991-Q1_0150-0199 Ammodytidae       0070-00…       2   9.07 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> all_Gadus morhua_1991-Q1_0150-0199 Ammodytidae       0150-01…       4  29.4  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> all_Gadus morhua_1991-Q1_0150-0199 other             9999-99…       0 378.   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> all_Gadus morhua_1991-Q1_0150-0199 Sprattus sprattus 0050-00…       1   0.170</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> all_Gadus morhua_1991-Q1_0150-0199 Sprattus sprattus 0070-00…       2   1.17 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> all_Gadus morhua_1991-Q1_0200-0249 Ammodytidae       0050-00…       1  94.8  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> all_Gadus morhua_1991-Q1_0200-0249 Ammodytidae       0100-01…       3   3.80 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> all_Gadus morhua_1991-Q1_0200-0249 other             9999-99…       0 829.   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> all_Gadus morhua_1991-Q1_0200-0249 Sprattus sprattus 0070-00…       2  29.3  </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 459 more rows, and abbreviated variable names ¹​prey_size,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ²​prey_size_class</span></span></span>
<span></span>
<span><span class="co"># show parts of the control attributes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">d</span>,<span class="st">'control'</span><span class="op">)</span>,show<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'calc_diet'</span>,<span class="st">'stratification'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; #### group: calc_diet </span></span>
<span><span class="co">#&gt; sel_preys:  chr [1:7] "Gadus morhua" "Merlangius merlangus" "Melanogrammus aeglefinus" ...</span></span>
<span><span class="co">#&gt; min_prey_length:  int 50</span></span>
<span><span class="co">#&gt; calc_sub_strata: List of 3</span></span>
<span><span class="co">#&gt;  $ relative_weight      : logi FALSE</span></span>
<span><span class="co">#&gt;  $ weighting_factor     :  expression(n_tot)</span></span>
<span><span class="co">#&gt;  $ weighting_factor_file: logi NA</span></span>
<span><span class="co">#&gt; calc_strata: List of 3</span></span>
<span><span class="co">#&gt;  $ relative_weight      : logi FALSE</span></span>
<span><span class="co">#&gt;  $ weighting_factor     :  expression(sqrt(mean_cpue))</span></span>
<span><span class="co">#&gt;  $ weighting_factor_file: logi NA</span></span>
<span><span class="co">#&gt; calc_total: List of 3</span></span>
<span><span class="co">#&gt;  $ relative_weight      : logi FALSE</span></span>
<span><span class="co">#&gt;  $ weighting_factor     : logi NA</span></span>
<span><span class="co">#&gt;  $ weighting_factor_file: chr "/tmp/Rtmpv4RwBU/temp_libpath5b021b277167/FishStomachs/extdata/weighting_total.csv"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; #### group: stratification </span></span>
<span><span class="co">#&gt; strata_area_exp:   expression(paste("R", area, sep = "-"))</span></span>
<span><span class="co">#&gt; strata_sub_area_exp:   expression(rectangle)</span></span>
<span><span class="co">#&gt; strata_time_exp:   expression(paste0(year, "-Q", quarter))</span></span>
<span><span class="co">#&gt; strata_year_back:   expression(as.numeric(substr(stratum_time, 1, 4)))</span></span>
<span><span class="co">#&gt; strata_quarter_back:   expression(as.numeric(substr(stratum_time, 7, 8)))</span></span></code></pre></div>
<p>STOMdiet objects can be sub-setted and combined by the methods subset
and c. </p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># make a subset of data</span></span>
<span><span class="va">d1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">d</span>,<span class="va">pred_size</span><span class="op">==</span><span class="st">'0400-0499'</span> <span class="op">&amp;</span> <span class="va">stratum_time</span><span class="op">==</span><span class="st">"1991-Q1"</span><span class="op">)</span></span>
<span><span class="va">d1</span></span>
<span><span class="co">#&gt; Object of class 'STOMdiet'</span></span>
<span><span class="co">#&gt; ===========================</span></span>
<span><span class="co">#&gt; Number stomachs: 327 </span></span>
<span><span class="co">#&gt; Predators: Gadus morhua </span></span>
<span><span class="co">#&gt; Number of prey names: 8 </span></span>
<span><span class="co">#&gt; Prey names:Ammodytidae; Clupea harengus; Gadus morhua; Melanogrammus aeglefinus; </span></span>
<span><span class="co">#&gt;     Merlangius merlangus; Sprattus sprattus; Trisopterus esmarkii; other; </span></span>
<span><span class="co">#&gt; Temporal strata: 1991-Q1;</span></span>
<span></span>
<span><span class="co"># another subset</span></span>
<span><span class="va">d2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">d</span>, <span class="va">stratum_time</span><span class="op">==</span><span class="st">"1991-Q2"</span><span class="op">)</span></span>
<span><span class="va">d2</span></span>
<span><span class="co">#&gt; Object of class 'STOMdiet'</span></span>
<span><span class="co">#&gt; ===========================</span></span>
<span><span class="co">#&gt; Number stomachs: 3114 </span></span>
<span><span class="co">#&gt; Predators: Gadus morhua </span></span>
<span><span class="co">#&gt; Number of prey names: 8 </span></span>
<span><span class="co">#&gt; Prey names:Ammodytidae; Clupea harengus; Gadus morhua; Melanogrammus aeglefinus; </span></span>
<span><span class="co">#&gt;     Merlangius merlangus; Sprattus sprattus; Trisopterus esmarkii; other; </span></span>
<span><span class="co">#&gt; Temporal strata: 1991-Q2;</span></span>
<span></span>
<span><span class="co">#combine subsets</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">d1</span>,<span class="va">d2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Object of class 'STOMdiet'</span></span>
<span><span class="co">#&gt; ===========================</span></span>
<span><span class="co">#&gt; Number stomachs: 3441 </span></span>
<span><span class="co">#&gt; Predators: Gadus morhua </span></span>
<span><span class="co">#&gt; Number of prey names: 8 </span></span>
<span><span class="co">#&gt; Prey names:Ammodytidae; Clupea harengus; Gadus morhua; Melanogrammus aeglefinus; </span></span>
<span><span class="co">#&gt;     Merlangius merlangus; Sprattus sprattus; Trisopterus esmarkii; other; </span></span>
<span><span class="co">#&gt; Temporal strata: 1991-Q1;  1991-Q2;</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">d1</span>,<span class="va">d2</span><span class="op">)</span></span></code></pre></div>
<p>It is also possible to transform STOMdiet object into a plain
data.frame, modify data and convert back again.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># convert into a data frame</span></span>
<span><span class="va">df</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span><span class="va">df</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 469 × 13</span></span></span>
<span><span class="co">#&gt;    stratum…¹ strat…² pred_…³ pred_…⁴ pred_…⁵ n_tot n_sam…⁶ pred_…⁷ key   prey_…⁸</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> all       1991-Q1 Gadus … 0100-0…       3    42      18     135 all_… other  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> all       1991-Q1 Gadus … 0150-0…       4   117      51     175 all_… Ammody…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> all       1991-Q1 Gadus … 0150-0…       4   117      51     175 all_… Ammody…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> all       1991-Q1 Gadus … 0150-0…       4   117      51     175 all_… other  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> all       1991-Q1 Gadus … 0150-0…       4   117      51     175 all_… Spratt…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> all       1991-Q1 Gadus … 0150-0…       4   117      51     175 all_… Spratt…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> all       1991-Q1 Gadus … 0200-0…       5   123      56     225 all_… Ammody…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> all       1991-Q1 Gadus … 0200-0…       5   123      56     225 all_… Ammody…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> all       1991-Q1 Gadus … 0200-0…       5   123      56     225 all_… other  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> all       1991-Q1 Gadus … 0200-0…       5   123      56     225 all_… Spratt…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 459 more rows, 3 more variables: prey_size &lt;fct&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   prey_size_class &lt;int&gt;, prey_w &lt;dbl&gt;, and abbreviated variable names</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ¹​stratum_area, ²​stratum_time, ³​pred_name, ⁴​pred_size, ⁵​pred_size_class,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ⁶​n_sample, ⁷​pred_l_mean, ⁸​prey_name</span></span></span>
<span></span>
<span><span class="co"># add a variable </span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">cannibal</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">pred_name</span><span class="op">)</span><span class="op">==</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">prey_name</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#convert it back to a STOMdiet object with a new PREY variable</span></span>
<span><span class="va">d2</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/as_STOMdiet.html">as_STOMdiet</a></span><span class="op">(</span><span class="va">df</span>,new_prey_var <span class="op">=</span> <span class="st">'cannibal'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># "cannibal" s now included (in the PREY data set)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">d2</span><span class="op">[[</span><span class="st">'PREY'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "key"             "prey_name"       "prey_size"       "prey_size_class"</span></span>
<span><span class="co">#&gt; [5] "prey_w"          "cannibal"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">d2</span><span class="op">)</span></span></code></pre></div>
<p>There are various summary functions available for the STOMdiet
object.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span><span class="co">#&gt; Number of stomachs by predator and year:</span></span>
<span><span class="co">#&gt;               year</span></span>
<span><span class="co">#&gt; pred_name      1991</span></span>
<span><span class="co">#&gt;   Gadus morhua 9660</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">d</span>,level<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Number of stomachs by predator and year:</span></span>
<span><span class="co">#&gt;                   quarter    1    2    3    4</span></span>
<span><span class="co">#&gt; pred_name    year                            </span></span>
<span><span class="co">#&gt; Gadus morhua 1991         2187 3114 1885 2474</span></span>
<span></span>
<span><span class="co"># make a subset of data</span></span>
<span><span class="va">d1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">d</span>,<span class="va">pred_size</span><span class="op">==</span><span class="st">'0300-0399'</span> <span class="op">&amp;</span> <span class="va">stratum_time</span><span class="op">==</span><span class="st">"1991-Q1"</span><span class="op">)</span></span>
<span><span class="va">d1</span></span>
<span><span class="co">#&gt; Object of class 'STOMdiet'</span></span>
<span><span class="co">#&gt; ===========================</span></span>
<span><span class="co">#&gt; Number stomachs: 379 </span></span>
<span><span class="co">#&gt; Predators: Gadus morhua </span></span>
<span><span class="co">#&gt; Number of prey names: 6 </span></span>
<span><span class="co">#&gt; Prey names:Ammodytidae; Clupea harengus; Merlangius merlangus; Sprattus sprattus; </span></span>
<span><span class="co">#&gt;     Trisopterus esmarkii; other; Temporal strata: 1991-Q1;</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">d1</span>,level<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; Absolute weight:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Gadus morhua, 0300-0399, 1991, Q:1, n stomachs:379</span></span>
<span><span class="co">#&gt; Absolute weight:</span></span>
<span><span class="co">#&gt;                       prey_size</span></span>
<span><span class="co">#&gt; prey_name              0050-0069 0070-0099 0100-0149 0150-0199 0200-0249</span></span>
<span><span class="co">#&gt;   Ammodytidae               10.0     173.7     296.1       0.3       0.0</span></span>
<span><span class="co">#&gt;   Clupea harengus            0.0     218.0       0.0     184.5      17.5</span></span>
<span><span class="co">#&gt;   Merlangius merlangus       0.0       0.0     961.0    1212.0       0.0</span></span>
<span><span class="co">#&gt;   Sprattus sprattus          0.0      22.5       0.0       0.0       0.0</span></span>
<span><span class="co">#&gt;   Trisopterus esmarkii       0.0       0.0     732.4       0.0       0.0</span></span>
<span><span class="co">#&gt;   other                      0.0       0.0       0.0       0.0       0.0</span></span>
<span><span class="co">#&gt;                       prey_size</span></span>
<span><span class="co">#&gt; prey_name              9999-9999</span></span>
<span><span class="co">#&gt;   Ammodytidae                0.0</span></span>
<span><span class="co">#&gt;   Clupea harengus            0.0</span></span>
<span><span class="co">#&gt;   Merlangius merlangus       0.0</span></span>
<span><span class="co">#&gt;   Sprattus sprattus          0.0</span></span>
<span><span class="co">#&gt;   Trisopterus esmarkii       0.0</span></span>
<span><span class="co">#&gt;   other                   1865.1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">d1</span>,level<span class="op">=</span><span class="fl">4</span>,drop.unused.levels<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Relative weight in percentages:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Gadus morhua, 0300-0399, 1991, Q:1, n stomachs:379</span></span>
<span><span class="co">#&gt;                      0050-0069 0070-0099 0100-0149 0150-0199 0200-0249</span></span>
<span><span class="co">#&gt; Ammodytidae                0.2       3.1       5.2       0.0       0.0</span></span>
<span><span class="co">#&gt; Clupea harengus            0.0       3.8       0.0       3.2       0.3</span></span>
<span><span class="co">#&gt; Merlangius merlangus       0.0       0.0      16.9      21.3       0.0</span></span>
<span><span class="co">#&gt; Sprattus sprattus          0.0       0.4       0.0       0.0       0.0</span></span>
<span><span class="co">#&gt; Trisopterus esmarkii       0.0       0.0      12.9       0.0       0.0</span></span>
<span><span class="co">#&gt; other                      0.0       0.0       0.0       0.0       0.0</span></span>
<span><span class="co">#&gt; all                        0.2       7.3      34.9      24.5       0.3</span></span>
<span><span class="co">#&gt;                      9999-9999   all</span></span>
<span><span class="co">#&gt; Ammodytidae                0.0   8.4</span></span>
<span><span class="co">#&gt; Clupea harengus            0.0   7.4</span></span>
<span><span class="co">#&gt; Merlangius merlangus       0.0  38.2</span></span>
<span><span class="co">#&gt; Sprattus sprattus          0.0   0.4</span></span>
<span><span class="co">#&gt; Trisopterus esmarkii       0.0  12.9</span></span>
<span><span class="co">#&gt; other                     32.8  32.8</span></span>
<span><span class="co">#&gt; all                       32.8 100.0</span></span></code></pre></div>
<p>And plots of relative stomach contents in weight.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#default</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span></code></pre></div>
<p><img src="ex04_Population_diet_files/figure-html/ex04_05-1.png" width="672"></p>
<pre><code><span><span class="co">#&gt; NULL</span></span>
<span></span>
<span><span class="co"># change in layout, shorter predator size on the x-axis ("from" value),</span></span>
<span><span class="co">#   added number of stomachs and added title</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">d</span>,Ncol<span class="op">=</span><span class="fl">1</span>,cut_pred_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span>,addTitle <span class="op">=</span> <span class="cn">TRUE</span>, addNstom<span class="op">=</span><span class="cn">TRUE</span>,refac_prey<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
<p><img src="ex04_Population_diet_files/figure-html/ex04_05-2.png" width="672"></p>
<pre><code><span><span class="co">#&gt; NULL</span></span></code></pre>
<p>It is possible to change the names of both predator and prey
species.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Change names into English names</span></span>
<span><span class="va">d2</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/from_to_species_diet.html">from_to_species_diet</a></span><span class="op">(</span><span class="va">d</span>,pred_from_to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"species"</span>,<span class="st">"short"</span><span class="op">)</span>,prey_from_to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"species"</span>,<span class="st">"short"</span><span class="op">)</span>,</span>
<span>          sp_info_file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span> package <span class="op">=</span> <span class="st">"FishStomachs"</span><span class="op">)</span>,<span class="st">"extdata"</span>,<span class="st">'species_info.csv'</span><span class="op">)</span><span class="op">)</span></span>
<span>                         </span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">d2</span>,Ncol<span class="op">=</span><span class="fl">1</span>,cut_pred_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span>,addTitle <span class="op">=</span> <span class="cn">TRUE</span>, addNstom<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="ex04_Population_diet_files/figure-html/ex04_06-1.png" width="672"></p>
<pre><code><span><span class="co">#&gt; NULL</span></span></code></pre>
<p>Plots can also be done where the prey size class is shown. In this
plot data from all quarters in 1991 are combined (weighted mean, by
number of stomachs, of all quarters of 1991).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># detailed plot by predator size class at the top, </span></span>
<span><span class="co">#   prey size class on the x-axis and prey species shown at the right margin. </span></span>
<span><span class="co">#   The very small predators are excluded from the plot.</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plotSize.html">plotSize</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">d2</span>,<span class="op">!</span><span class="op">(</span><span class="va">pred_size</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0100-0149"</span>,<span class="st">"0150-0199"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, </span>
<span>          cut_pred_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>,addTitle<span class="op">=</span><span class="cn">TRUE</span>, byVar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'year-quarter'</span>,<span class="st">'year'</span>,<span class="st">'quarter'</span>,<span class="st">'none'</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="ex04_Population_diet_files/figure-html/ex04_07-1.png" width="672"></p>
<pre><code><span><span class="co">#&gt; NULL</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># table of differences</span></span>
<span><span class="va">a</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs</a></span><span class="op">(</span><span class="va">prey_w</span><span class="op">~</span><span class="va">prey_name</span><span class="op">+</span><span class="va">key</span>,data<span class="op">=</span><span class="va">d_simple</span><span class="op">[[</span><span class="st">'PREY'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>;</span>
<span><span class="co"># round(rbind(a,apply(a,2,sum)),3)</span></span>
<span></span>
<span><span class="va">d1</span><span class="op">&lt;-</span><span class="va">d2</span></span>
<span><span class="co">#Relative stomach contents</span></span>
<span><span class="va">d1</span><span class="op">[[</span><span class="st">'PREY'</span><span class="op">]</span><span class="op">]</span><span class="op">&lt;-</span> <span class="va">d1</span><span class="op">[[</span><span class="st">'PREY'</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">key</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>prey_w<span class="op">=</span><span class="va">prey_w</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">prey_w</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">b</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs</a></span><span class="op">(</span><span class="va">prey_w</span><span class="op">~</span><span class="va">prey_name</span><span class="op">+</span><span class="va">key</span>,data<span class="op">=</span><span class="va">d1</span><span class="op">[[</span><span class="st">'PREY'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>;</span>
<span><span class="co"># round(rbind(b,apply(b,2,sum)),3)</span></span>
<span></span>
<span><span class="co"># round((a-b)*1000)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="../reference/plotdif.html">plotdif</a></span><span class="op">(</span>d1<span class="op">=</span><span class="va">d1</span>,d2<span class="op">=</span><span class="va">d_simple</span>,show_plot<span class="op">=</span><span class="cn">TRUE</span>,cut_pred_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span>,cut_prey_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span>,addTitle<span class="op">=</span><span class="cn">TRUE</span>,tAngle<span class="op">=</span><span class="fl">90</span>,</span>
<span>                  refac_prey<span class="op">=</span><span class="cn">FALSE</span>, relative<span class="op">=</span><span class="cn">FALSE</span>,maxDif<span class="op">=</span><span class="fl">3</span>,</span>
<span>                  byVar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'year-quarter'</span>,<span class="st">'year'</span>,<span class="st">'quarter'</span>,<span class="st">'none'</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="ex04_Population_diet_files/figure-html/ex04_09-1.png" width="672"></p>
<pre><code><span><span class="co">#&gt; NULL</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="../reference/plotdif.html">plotdif</a></span><span class="op">(</span>d1<span class="op">=</span><span class="va">d1</span>,d2<span class="op">=</span><span class="va">d_simple</span>,show_plot<span class="op">=</span><span class="cn">TRUE</span>,cut_pred_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span>,cut_prey_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span>,addTitle<span class="op">=</span><span class="cn">TRUE</span>,tAngle<span class="op">=</span><span class="fl">90</span>,</span>
<span>        refac_prey<span class="op">=</span><span class="cn">FALSE</span>, relative<span class="op">=</span><span class="cn">TRUE</span>,maxDif<span class="op">=</span><span class="fl">3</span>,</span>
<span>        byVar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'year-quarter'</span>,<span class="st">'year'</span>,<span class="st">'quarter'</span>,<span class="st">'none'</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span></code></pre>
<p><img src="ex04_Population_diet_files/figure-html/ex04_09-2.png" width="672"></p>
<pre><code><span><span class="co">#&gt; NULL</span></span></code></pre>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Morten Vinther.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
