<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>example 01: Read and manipulate data • FishStomachs</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="example 01: Read and manipulate data">
<meta property="og:description" content="FishStomachs">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FishStomachs</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/FishStomachs.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ex01_Read_and_manipulate_data.html">example 01: Read and manipulate data</a>
    </li>
    <li>
      <a href="../articles/ex02_More_data_manipulations.html">Example 02: More data manipulations</a>
    </li>
    <li>
      <a href="../articles/ex03_Estimate_population_diet.html">Example 03: Estimate population diet</a>
    </li>
    <li>
      <a href="../articles/ex04_Population_diet.html">Example 04: Population diet</a>
    </li>
    <li>
      <a href="../articles/ex05_Create_data_for_model.html">Example 05:Create data for model</a>
    </li>
    <li>
      <a href="../articles/ex06_Bootstrapping.html">Example 06 Bootstrapping</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>example 01: Read and manipulate data</h1>
            
      
      
      <div class="hidden name"><code>ex01_Read_and_manipulate_data.Rmd</code></div>

    </div>

    
    
<p>This example shows the basic data structures and how to read data on
exchange data format. Further, examples are shown on and how to make
initial editing and addition of data.</p>
<div class="section level3">
<h3 id="basic-data-structures-and-reading-data-from-exchange-format">Basic data structures and reading data from exchange format<a class="anchor" aria-label="anchor" href="#basic-data-structures-and-reading-data-from-exchange-format"></a>
</h3>
<p>FishStomachs gives the opportunity to process data and to document
this process. It uses a control (or option) object (REF) to specify
input data and the processing of data.</p>
<p>First we have to make a control object, to specify which data we want
to import. Stomach contents data are in this case from the data set,
cod_stom_1991.csv, included in the FishStomachs package. The stomach_dir
must also include a CSV file (database_format.csv) where the data set
structure is defined, and which alias for field names that can used and
which fields that are mandatory.</p>
<p>In this case, data from 1991 and for the predator cod (<em>Gadus
morhua</em>) are used.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">FishStomachs</span><span class="op">)</span></span>
<span></span>
<span><span class="va">control</span><span class="op">&lt;-</span><span class="fu">new</span><span class="op">(</span><span class="st">"STOMcontrol"</span>,</span>
<span>        name<span class="op">=</span><span class="st">"Test cod"</span>,  <span class="co"># just a name</span></span>
<span>        <span class="co"># Specify where to find data on exchange format. </span></span>
<span>        <span class="co"># This example uses data for cod incl. in the package</span></span>
<span>        stomach_dir<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span> package <span class="op">=</span> <span class="st">"FishStomachs"</span><span class="op">)</span>,<span class="st">"extdata"</span><span class="op">)</span>, </span>
<span>        dataSets<span class="op">=</span><span class="st">"cod_stom_1991.csv"</span>,</span>
<span>        predators<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Gadus morhua"</span><span class="op">)</span>,</span>
<span>        years<span class="op">=</span><span class="fl">1991L</span> <span class="co"># keep only data from 1991</span></span>
<span>        <span class="op">)</span></span>
<span></span>
<span><span class="co">#print(control) # This will show the full list of options</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">control</span>,show<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'general'</span>,<span class="st">'data_used'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; #### group: general </span></span>
<span><span class="co">#&gt; name:  chr "Test cod"</span></span>
<span><span class="co">#&gt; stomach_format:   expression(system.file("stomach_format.csv", package = "FishStomachs"))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; #### group: data_used </span></span>
<span><span class="co">#&gt; stomach_dir:  chr "/tmp/Rtmpv4RwBU/temp_libpath5b021b277167/FishStomachs/extdata"</span></span>
<span><span class="co">#&gt; dataSets:  chr "cod_stom_1991.csv"</span></span>
<span><span class="co">#&gt; years:  int 1991</span></span>
<span><span class="co">#&gt; quarters:  int [1:4] 1 2 3 4</span></span>
<span><span class="co">#&gt; predators:  chr "Gadus morhua"</span></span></code></pre></div>
<p>The stomach_format in the control shows where to find the format and
for the input file. In this case it is the default value that is used,
which is the file included in FishStomachs, but another specification
file can be specified, see vignette FishStomachs.</p>
<p>Data are read in using the read_exchange_data function.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/read_exchange_data.html">read_exchange_data</a></span><span class="op">(</span><span class="va">control</span>,keep_just_mandatory_fields <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Processing file_ /tmp/Rtmpv4RwBU/temp_libpath5b021b277167/FishStomachs/extdata/cod_stom_1991.csv</span></span></code></pre></div>
<p>In this case we just want to keep the mandatory data fields (for
illustrative purposes) as specified by the parameter
keep_just_mandatory_fields. See the documentation for exchange format in
the help for .</p>
<p>The resulting “s” data from the is the basic structure used for
stomach contents data. Technically, s is an object of the class STOMobs,
which is a list with one data set on the predator and another set with
information of the preys (see below). One predator record may have
several prey records. The two sets are linked by the variables sample_id
and fish_id. More text on the individual fields can be found in the
documentation for exchange format (REF). A STOMobs object also includes
some attributes about the compilation of data attached to the object,
and a control object (class ) for providing options for compilation and
documentations</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 2</span></span>
<span><span class="co">#&gt;  $ PRED: tibble [4,104 × 21] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ dataset  : Factor w/ 1 level "NS": 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ country  : Factor w/ 7 levels "DEN","ENG","FRA",..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ ship     : Factor w/ 13 levels "CIR","COM","DAN",..: 4 4 4 4 4 4 4 4 4 4 ...</span></span>
<span><span class="co">#&gt;   ..$ rectangle: Factor w/ 180 levels "31F2","32F1",..: 67 79 47 38 31 68 79 38 31 47 ...</span></span>
<span><span class="co">#&gt;   ..$ area     : Factor w/ 9 levels "1","2","3","4",..: 7 7 6 4 6 7 7 4 6 6 ...</span></span>
<span><span class="co">#&gt;   ..$ year     : int [1:4104] 1991 1991 1991 1991 1991 1991 1991 1991 1991 1991 ...</span></span>
<span><span class="co">#&gt;   ..$ quarter  : int [1:4104] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ month    : int [1:4104] 2 2 2 2 2 2 2 2 2 2 ...</span></span>
<span><span class="co">#&gt;   ..$ day      : int [1:4104] 19 7 8 13 11 7 7 13 11 8 ...</span></span>
<span><span class="co">#&gt;   ..$ station  : Factor w/ 402 levels "1","10","100",..: 175 1 270 94 45 93 1 94 45 270 ...</span></span>
<span><span class="co">#&gt;   ..$ haul     : Factor w/ 402 levels "1","10","100",..: 175 1 270 94 45 93 1 94 45 270 ...</span></span>
<span><span class="co">#&gt;   ..$ sample_id: Factor w/ 4104 levels "Gadus morhua_DEN_y:91_q:1_ID:109",..: 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">#&gt;   ..$ fish_id  : Factor w/ 4104 levels "10","100","1000",..: 87 165 298 332 420 542 653 698 1009 1097 ...</span></span>
<span><span class="co">#&gt;   ..$ pred_name: Factor w/ 1 level "Gadus morhua": 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ pred_l   : int [1:4104] 225 225 225 275 275 135 135 325 325 135 ...</span></span>
<span><span class="co">#&gt;   ..$ pred_ll  : int [1:4104] 200 200 200 250 250 120 120 300 300 120 ...</span></span>
<span><span class="co">#&gt;   ..$ pred_lu  : int [1:4104] 250 250 250 300 300 150 150 350 350 150 ...</span></span>
<span><span class="co">#&gt;   ..$ n_food   : int [1:4104] 1 1 1 1 1 1 3 1 4 4 ...</span></span>
<span><span class="co">#&gt;   ..$ n_regur  : int [1:4104] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ n_skel   : int [1:4104] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ n_empty  : int [1:4104] 0 0 1 0 0 0 2 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ PREY: tibble [16,160 × 10] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ sample_id  : Factor w/ 4104 levels "Gadus morhua_DEN_y:91_q:1_ID:109",..: 1 1 2 2 2 2 3 4 4 5 ...</span></span>
<span><span class="co">#&gt;   ..$ fish_id    : Factor w/ 4104 levels "10","100","1000",..: 87 87 165 165 165 165 298 332 332 420 ...</span></span>
<span><span class="co">#&gt;   ..$ prey_name  : Factor w/ 222 levels "Agonus cataphractus",..: 145 29 186 84 50 170 207 168 50 145 ...</span></span>
<span><span class="co">#&gt;   ..$ digest     : int [1:16160] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ prey_l     : num [1:16160] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;   ..$ prey_ll    : int [1:16160] NA 35 12 12 25 NA 80 NA 25 NA ...</span></span>
<span><span class="co">#&gt;   ..$ prey_lu    : int [1:16160] NA 40 15 15 30 NA 100 NA 30 NA ...</span></span>
<span><span class="co">#&gt;   ..$ prey_w_meth: Factor w/ 1 level "r": 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ prey_n     : int [1:16160] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ prey_w     : num [1:16160] 1.66 0.37 0.03 0.02 0.13 0.09 5.07 0.08 0.22 0.86 ...</span></span>
<span><span class="co">#&gt;  - attr(*, "Changes done")= logi FALSE</span></span>
<span><span class="co">#&gt;  - attr(*, "Prey weights by record done")= logi FALSE</span></span>
<span><span class="co">#&gt;  - attr(*, "Bias corrected, energy contents, armament etc")= logi FALSE</span></span>
<span><span class="co">#&gt;  - attr(*, "Predator size class assigned")= logi FALSE</span></span>
<span><span class="co">#&gt;  - attr(*, "Bias corrected, regurgitated stomachs")= logi FALSE</span></span>
<span><span class="co">#&gt;  - attr(*, "Prey size class assigned")= logi FALSE</span></span>
<span><span class="co">#&gt;  - attr(*, "Aggregate by sample ID and predator and prey size group")= logi FALSE</span></span>
<span><span class="co">#&gt;  - attr(*, "Temporal and spatial strata added")= logi FALSE</span></span>
<span><span class="co">#&gt;  - attr(*, "Allocate partly identified prey species")= logi FALSE</span></span>
<span><span class="co">#&gt;  - attr(*, "Allocate missing prey length")= logi FALSE</span></span>
<span><span class="co">#&gt;  - attr(*, "control")=Formal class 'STOMcontrol' [package "FishStomachs"] with 31 slots</span></span>
<span><span class="co">#&gt;   .. ..@ name                 : chr "Test cod"</span></span>
<span><span class="co">#&gt;   .. ..@ stomach_format       :  expression(system.file("stomach_format.csv", package = "FishStomachs"))</span></span>
<span><span class="co">#&gt;   .. ..@ stomach_dir          : chr "/tmp/Rtmpv4RwBU/temp_libpath5b021b277167/FishStomachs/extdata"</span></span>
<span><span class="co">#&gt;   .. ..@ dataSets             : chr "cod_stom_1991.csv"</span></span>
<span><span class="co">#&gt;   .. ..@ years                : int 1991</span></span>
<span><span class="co">#&gt;   .. ..@ quarters             : int [1:4] 1 2 3 4</span></span>
<span><span class="co">#&gt;   .. ..@ predators            : chr "Gadus morhua"</span></span>
<span><span class="co">#&gt;   .. ..@ strata_area_exp      :  expression(paste0("SD-", area))</span></span>
<span><span class="co">#&gt;   .. ..@ strata_sub_area_exp  :  expression(paste0("SD-", area))</span></span>
<span><span class="co">#&gt;   .. ..@ strata_time_exp      :  expression(paste0(year, "-Q", quarter))</span></span>
<span><span class="co">#&gt;   .. ..@ strata_year_back     :  expression(as.numeric(substr(stratum_time, 1, 4)))</span></span>
<span><span class="co">#&gt;   .. ..@ strata_quarter_back  :  expression(as.numeric(substr(stratum_time, 7, 8)))</span></span>
<span><span class="co">#&gt;   .. ..@ sel_preys            : chr "prey1"</span></span>
<span><span class="co">#&gt;   .. ..@ min_prey_length      : int 50</span></span>
<span><span class="co">#&gt;   .. ..@ calc_sub_strata      :List of 3</span></span>
<span><span class="co">#&gt;   .. .. ..$ relative_weight             : logi FALSE</span></span>
<span><span class="co">#&gt;   .. .. ..$ weighting_factor            :  expression(n_tot)</span></span>
<span><span class="co">#&gt;   .. .. ..$ import_weighting_factor_file: logi NA</span></span>
<span><span class="co">#&gt;   .. ..@ calc_strata          :List of 3</span></span>
<span><span class="co">#&gt;   .. .. ..$ relative_weight             : logi FALSE</span></span>
<span><span class="co">#&gt;   .. .. ..$ weighting_factor            :  expression(n_tot)</span></span>
<span><span class="co">#&gt;   .. .. ..$ import_weighting_factor_file: logi NA</span></span>
<span><span class="co">#&gt;   .. ..@ calc_total           :List of 3</span></span>
<span><span class="co">#&gt;   .. .. ..$ relative_weight             : logi FALSE</span></span>
<span><span class="co">#&gt;   .. .. ..$ weighting_factor            :  expression(n_tot)</span></span>
<span><span class="co">#&gt;   .. .. ..$ import_weighting_factor_file: logi NA</span></span>
<span><span class="co">#&gt;   .. ..@ model_options        :List of 6</span></span>
<span><span class="co">#&gt;   .. .. ..$ delete_small    : logi TRUE</span></span>
<span><span class="co">#&gt;   .. .. ..$ min_stom        : num 1e-04</span></span>
<span><span class="co">#&gt;   .. .. ..$ insert_mid_value: logi TRUE</span></span>
<span><span class="co">#&gt;   .. .. ..$ mid_value       : num 1e-04</span></span>
<span><span class="co">#&gt;   .. .. ..$ insert_tails    : logi FALSE</span></span>
<span><span class="co">#&gt;   .. .. ..$ tail_value      : num 1e-04</span></span>
<span><span class="co">#&gt;   .. ..@ ALK_options          :List of 3</span></span>
<span><span class="co">#&gt;   .. .. ..$ first_age              : int 0</span></span>
<span><span class="co">#&gt;   .. .. ..$ first_quarter_first_age: int 3</span></span>
<span><span class="co">#&gt;   .. .. ..$ minimum_alk            : num 1e-04</span></span>
<span><span class="co">#&gt;   .. ..@ max_l                : int 9999</span></span>
<span><span class="co">#&gt;   .. ..@ mis_l                : int 9999</span></span>
<span><span class="co">#&gt;   .. ..@ mis_digest           : int 9</span></span>
<span><span class="co">#&gt;   .. ..@ other                : chr "other"</span></span>
<span><span class="co">#&gt;   .. ..@ mis_size_class       : int 0</span></span>
<span><span class="co">#&gt;   .. ..@ do_test_output       : logi FALSE</span></span>
<span><span class="co">#&gt;   .. ..@ do_test_output_file  : logi FALSE</span></span>
<span><span class="co">#&gt;   .. ..@ tst_file             : chr "my_detailed.file"</span></span>
<span><span class="co">#&gt;   .. ..@ detailed_tst_output  : logi FALSE</span></span>
<span><span class="co">#&gt;   .. ..@ detailed_tst_file    : chr "my_detailed.file"</span></span>
<span><span class="co">#&gt;   .. ..@ detailed_tst_criteria:List of 9</span></span>
<span><span class="co">#&gt;   .. .. ..$ year               :  expression(year == 1974L)</span></span>
<span><span class="co">#&gt;   .. .. ..$ quarter            :  expression(quarter == 1L)</span></span>
<span><span class="co">#&gt;   .. .. ..$ area               :  expression(area == 26)</span></span>
<span><span class="co">#&gt;   .. .. ..$ pred_l             :  expression(pred_l %in% 400:499)</span></span>
<span><span class="co">#&gt;   .. .. ..$ pred_size          :  expression(pred_size == "0400-0499")</span></span>
<span><span class="co">#&gt;   .. .. ..$ pred_name          :  expression(pred_name == "Gadus morhua")</span></span>
<span><span class="co">#&gt;   .. .. ..$ stratum_time       :  expression(stratum_time == "1974-Q1")</span></span>
<span><span class="co">#&gt;   .. .. ..$ stratum_time       :  expression(stratum_area == "SD-26")</span></span>
<span><span class="co">#&gt;   .. .. ..$ my_output_variables: chr [1:10] "dataset" "country" "area" "year" ...</span></span>
<span><span class="co">#&gt;   .. ..@ bootstrapping        :List of 2</span></span>
<span><span class="co">#&gt;   .. .. ..$ boots_id    :  expression(paste(country, ship, year, quarter, haul, spe = "_"))</span></span>
<span><span class="co">#&gt;   .. .. ..$ boots_strata:  expression(paste(year, quarter, pred_name))</span></span>
<span><span class="co">#&gt;  - attr(*, "class")= chr "STOMobs"</span></span>
<span><span class="co">#&gt;  - attr(*, "PRED")= chr [1:21] "dataset" "country" "ship" "rectangle" ...</span></span>
<span><span class="co">#&gt;  - attr(*, "PREY")= chr [1:10] "sample_id" "fish_id" "prey_name" "digest" ...</span></span>
<span><span class="va">s</span><span class="op">[[</span><span class="st">'PRED'</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4,104 × 21</span></span></span>
<span><span class="co">#&gt;    dataset country ship  rectangle area   year quarter month   day station haul </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> NS      DEN     DAN2  40F6      7      <span style="text-decoration: underline;">1</span>991       1     2    19 34      34   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> NS      DEN     DAN2  41F7      7      <span style="text-decoration: underline;">1</span>991       1     2     7 1       1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> NS      DEN     DAN2  38F8      6      <span style="text-decoration: underline;">1</span>991       1     2     8 5       5    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> NS      DEN     DAN2  38E9      4      <span style="text-decoration: underline;">1</span>991       1     2    13 20      20   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> NS      DEN     DAN2  37F3      6      <span style="text-decoration: underline;">1</span>991       1     2    11 14      14   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> NS      DEN     DAN2  40F7      7      <span style="text-decoration: underline;">1</span>991       1     2     7 2       2    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> NS      DEN     DAN2  41F7      7      <span style="text-decoration: underline;">1</span>991       1     2     7 1       1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> NS      DEN     DAN2  38E9      4      <span style="text-decoration: underline;">1</span>991       1     2    13 20      20   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> NS      DEN     DAN2  37F3      6      <span style="text-decoration: underline;">1</span>991       1     2    11 14      14   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> NS      DEN     DAN2  38F8      6      <span style="text-decoration: underline;">1</span>991       1     2     8 5       5    </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 4,094 more rows, and 10 more variables: sample_id &lt;fct&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   fish_id &lt;fct&gt;, pred_name &lt;fct&gt;, pred_l &lt;int&gt;, pred_ll &lt;int&gt;, pred_lu &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   n_food &lt;int&gt;, n_regur &lt;int&gt;, n_skel &lt;int&gt;, n_empty &lt;int&gt;</span></span></span>
<span><span class="va">s</span><span class="op">[[</span><span class="st">'PREY'</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 16,160 × 10</span></span></span>
<span><span class="co">#&gt;    sample_id fish_id prey_…¹ digest prey_l prey_ll prey_lu prey_…² prey_n prey_w</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Gadus mo… 109     Paguru…      1     <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span> r            1   1.66</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Gadus mo… 109     Buglos…      1     <span style="color: #BB0000;">NA</span>      35      40 r            1   0.37</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Gadus mo… 116     Pseudo…      1     <span style="color: #BB0000;">NA</span>      12      15 r            1   0.03</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Gadus mo… 116     Gammar…      1     <span style="color: #BB0000;">NA</span>      12      15 r            1   0.02</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Gadus mo… 116     Crango…      1     <span style="color: #BB0000;">NA</span>      25      30 r            1   0.13</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Gadus mo… 116     Pomato…      1     <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span> r            1   0.09</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Gadus mo… 128     Spratt…      1     <span style="color: #BB0000;">NA</span>      80     100 r            1   5.07</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Gadus mo… 131     Polych…      1     <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span> r            1   0.08</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Gadus mo… 131     Crango…      1     <span style="color: #BB0000;">NA</span>      25      30 r            1   0.22</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Gadus mo… 139     Paguru…      1     <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span> r            1   0.86</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 16,150 more rows, and abbreviated variable names ¹​prey_name,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ²​prey_w_meth</span></span></span></code></pre></div>
<p>A subset of data can be made by the method subset, and several data
sets can be combined with the method c, see below.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># subset and show overview</span></span>
<span><span class="va">s1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">s</span>,<span class="va">quarter</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">s1</span>,show_attributes<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Object of class 'STOMobs'</span></span>
<span><span class="co">#&gt; ===========================</span></span>
<span><span class="co">#&gt; Number of samples: 1005 </span></span>
<span><span class="co">#&gt; Number stomachs with food : 1742 </span></span>
<span><span class="co">#&gt; Predators: Gadus morhua </span></span>
<span><span class="co">#&gt; Number of prey names: 145 </span></span>
<span><span class="co">#&gt; Years: 1991</span></span>
<span></span>
<span><span class="va">s234</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">s</span>,<span class="va">quarter</span> <span class="op">&gt;</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">s234</span>,show_attributes<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Object of class 'STOMobs'</span></span>
<span><span class="co">#&gt; ===========================</span></span>
<span><span class="co">#&gt; Number of samples: 3099 </span></span>
<span><span class="co">#&gt; Number stomachs with food : 6383 </span></span>
<span><span class="co">#&gt; Predators: Gadus morhua </span></span>
<span><span class="co">#&gt; Number of prey names: 193 </span></span>
<span><span class="co">#&gt; Years: 1991</span></span>
<span></span>
<span></span>
<span><span class="va">s1234</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">s1</span>,<span class="va">s234</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">s1234</span>,show_attributes<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Object of class 'STOMobs'</span></span>
<span><span class="co">#&gt; ===========================</span></span>
<span><span class="co">#&gt; Number of samples: 4104 </span></span>
<span><span class="co">#&gt; Number stomachs with food : 8125 </span></span>
<span><span class="co">#&gt; Predators: Gadus morhua </span></span>
<span><span class="co">#&gt; Number of prey names: 222 </span></span>
<span><span class="co">#&gt; Years: 1991</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">s1</span>,<span class="va">s234</span>,<span class="va">s1234</span><span class="op">)</span></span></code></pre></div>
<p>The overview of data does also show the status of manipulations,
which may be necessary to do to estimate population diet. The
FishStomachs package provides functions for these steps.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s</span></span>
<span><span class="co">#&gt; Object of class 'STOMobs'</span></span>
<span><span class="co">#&gt; ===========================</span></span>
<span><span class="co">#&gt; Number of samples: 4104 </span></span>
<span><span class="co">#&gt; Number stomachs with food : 8125 </span></span>
<span><span class="co">#&gt; Predators: Gadus morhua </span></span>
<span><span class="co">#&gt; Number of prey names: 222 </span></span>
<span><span class="co">#&gt; Years: 1991 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; FALSE: Changes done</span></span>
<span><span class="co">#&gt; FALSE: Prey weights by record done</span></span>
<span><span class="co">#&gt; FALSE: Bias corrected, energy contents, armament etc</span></span>
<span><span class="co">#&gt; FALSE: Predator size class assigned</span></span>
<span><span class="co">#&gt; FALSE: Bias corrected, regurgitated stomachs</span></span>
<span><span class="co">#&gt; FALSE: Prey size class assigned</span></span>
<span><span class="co">#&gt; FALSE: Aggregate by sample ID and predator and prey size group</span></span>
<span><span class="co">#&gt; FALSE: Temporal and spatial strata added</span></span>
<span><span class="co">#&gt; FALSE: Allocate partly identified prey species</span></span>
<span><span class="co">#&gt; FALSE: Allocate missing prey length</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="showing-data-for-a-subset-of-data">Showing data for a subset of data<a class="anchor" aria-label="anchor" href="#showing-data-for-a-subset-of-data"></a>
</h3>
<p>Data sets for stomach contents is often large which makes it almost
impossible to track the effect of data manipulation done for all
records. FishStomachs gives the opportunity to follow and document the
effects of data manipulations for a subset of the observations. This
subset is done by by specifying the group use of the
detailed_test_output in the control object within s.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_control.html">get_control</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span>,show<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'general'</span>,<span class="st">'detailed_test_output'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; #### group: general </span></span>
<span><span class="co">#&gt; name:  chr "Test cod"</span></span>
<span><span class="co">#&gt; stomach_format:   expression(system.file("stomach_format.csv", package = "FishStomachs"))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; #### group: detailed_test_output </span></span>
<span><span class="co">#&gt; detailed_tst_output:  logi FALSE</span></span>
<span><span class="co">#&gt; detailed_tst_file:  chr "my_detailed.file"</span></span>
<span><span class="co">#&gt; detailed_tst_criteria: List of 9</span></span>
<span><span class="co">#&gt;  $ year               :  expression(year == 1974L)</span></span>
<span><span class="co">#&gt;  $ quarter            :  expression(quarter == 1L)</span></span>
<span><span class="co">#&gt;  $ area               :  expression(area == 26)</span></span>
<span><span class="co">#&gt;  $ pred_l             :  expression(pred_l %in% 400:499)</span></span>
<span><span class="co">#&gt;  $ pred_size          :  expression(pred_size == "0400-0499")</span></span>
<span><span class="co">#&gt;  $ pred_name          :  expression(pred_name == "Gadus morhua")</span></span>
<span><span class="co">#&gt;  $ stratum_time       :  expression(stratum_time == "1974-Q1")</span></span>
<span><span class="co">#&gt;  $ stratum_time       :  expression(stratum_area == "SD-26")</span></span>
<span><span class="co">#&gt;  $ my_output_variables: chr [1:10] "dataset" "country" "area" "year" ...</span></span></code></pre></div>
<p>The default contents make no sense for this example and we have to
change it. This is done by changing the contents of list
detailed_tst_criteria to include any criteria for sub-setting data that
are further documented in the specified detailed_tst_file. The
detailed_tst_criteria should include one argument for each criteria you
want to apply, specified as an expression. You can define a criterion
for each field a STOMobs object. The easiest way to change values for
the control object is by using the built in functions .</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># makes a list with the criteria for the sub-set </span></span>
<span><span class="va">crit</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  pred_name<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">pred_name</span><span class="op">==</span> <span class="st">"Gadus morhua"</span><span class="op">)</span>,</span>
<span>  year<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">year</span><span class="op">==</span><span class="fl">1991</span><span class="op">)</span>,</span>
<span>  quarter<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">quarter</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>  sample_id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">sample_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Gadus morhua_FRA_y:91_q:1_ID:1008"</span>, <span class="st">"Gadus morhua_SCO_y:91_q:1_ID:582"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">s</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/edit_control.html">edit_control</a></span><span class="op">(</span><span class="va">s</span>,detailed_tst_output<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>                detailed_tst_file<span class="op">=</span><span class="st">'cod_sample.txt'</span>,</span>
<span>                detailed_tst_criteria<span class="op">=</span><span class="va">crit</span><span class="op">)</span></span>
<span><span class="co">#&gt; detailed_tst_output type; logical TRUE </span></span>
<span><span class="co">#&gt; detailed_tst_file type; character TRUE </span></span>
<span><span class="co">#&gt; detailed_tst_criteria type; list TRUE</span></span>
<span></span>
<span><span class="co"># extract the control object from s, and print the option groups selected</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_control.html">get_control</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span>,show<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'general'</span>,<span class="st">'detailed_test_output'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; #### group: general </span></span>
<span><span class="co">#&gt; name:  chr "Test cod"</span></span>
<span><span class="co">#&gt; stomach_format:   expression(system.file("stomach_format.csv", package = "FishStomachs"))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; #### group: detailed_test_output </span></span>
<span><span class="co">#&gt; detailed_tst_output:  logi TRUE</span></span>
<span><span class="co">#&gt; detailed_tst_file:  chr "cod_sample.txt"</span></span>
<span><span class="co">#&gt; detailed_tst_criteria: List of 4</span></span>
<span><span class="co">#&gt;  $ pred_name:  expression(pred_name == "Gadus morhua")</span></span>
<span><span class="co">#&gt;  $ year     :  expression(year == 1991)</span></span>
<span><span class="co">#&gt;  $ quarter  :  expression(quarter == 1)</span></span>
<span><span class="co">#&gt;  $ sample_id:  expression(sample_id %in% c("Gadus morhua_FRA_y:91_q:1_ID:1008", "Gadus morhua_SCO_y:91_q:1_ID:582"))</span></span>
<span><span class="fu"><a href="../reference/do_detailed_output.html">do_detailed_output</a></span><span class="op">(</span><span class="va">s</span>, by_sample_id<span class="op">=</span><span class="cn">TRUE</span>,to_screen<span class="op">=</span><span class="cn">TRUE</span>, label<span class="op">=</span><span class="st">'Start of example 01'</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Start of example 01 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  sample_id: Gadus morhua_FRA_y:91_q:1_ID:1008  fish_id: 1008 </span></span>
<span><span class="co">#&gt;                           80 100  120  150  200  250 9999   all</span></span>
<span><span class="co">#&gt; Aphrodite aculeata        NA  NA   NA   NA   NA   NA  4.3   4.3</span></span>
<span><span class="co">#&gt; Callionymus lyra         4.3  NA   NA   NA   NA   NA   NA   4.3</span></span>
<span><span class="co">#&gt; Clupea                    NA 0.9   NA   NA   NA   NA   NA   0.9</span></span>
<span><span class="co">#&gt; Clupea harengus           NA  NA   NA   NA 26.2   NA   NA  26.2</span></span>
<span><span class="co">#&gt; Corystes cassivelanus     NA  NA   NA   NA   NA   NA  2.0   2.0</span></span>
<span><span class="co">#&gt; Hippogloss. Platessoides  NA  NA  5.4 14.1   NA   NA   NA  19.5</span></span>
<span><span class="co">#&gt; Limanda limanda          1.0 8.3 10.7 60.2 31.6   NA   NA 111.9</span></span>
<span><span class="co">#&gt; Macropipus holsatus       NA  NA   NA   NA   NA   NA  1.4   1.4</span></span>
<span><span class="co">#&gt; Merlangius merlangus      NA  NA   NA   NA   NA 90.6   NA  90.6</span></span>
<span><span class="co">#&gt; Solea solea               NA  NA   NA 23.4   NA   NA   NA  23.4</span></span>
<span><span class="co">#&gt; all                      5.3 9.2 16.1 97.8 57.9 90.6  7.7 284.5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  sample_id: Gadus morhua_SCO_y:91_q:1_ID:582  fish_id: 582 </span></span>
<span><span class="co">#&gt;                       120  200 9999  all</span></span>
<span><span class="co">#&gt; Clupea harengus        NA 70.5   NA 70.5</span></span>
<span><span class="co">#&gt; Trisopterus esmarkii 20.8   NA    0 20.8</span></span>
<span><span class="co">#&gt; all                  20.8 70.5    0 91.3</span></span></code></pre></div>
<p>The output file (in this case shown on the screen, as parameter
to_screen=TRUE), shows the stomach contents weight by prey and prey size
for two samples.For a comprehensive documentation of the data
manipulation steps done, the output can be sampled in a file, or
appended to file already in use.</p>
<p>The relative stomach contents can also be shown.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># relative weight is shown</span></span>
<span><span class="fu"><a href="../reference/do_detailed_output.html">do_detailed_output</a></span><span class="op">(</span><span class="va">s</span>, by_sample_id<span class="op">=</span><span class="cn">TRUE</span>,to_screen<span class="op">=</span><span class="cn">TRUE</span>,rel_weight <span class="op">=</span> <span class="cn">TRUE</span>,label<span class="op">=</span><span class="st">'Relativ weight'</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Relativ weight </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  sample_id: Gadus morhua_FRA_y:91_q:1_ID:1008  fish_id: 1008 </span></span>
<span><span class="co">#&gt;                           80 100 120  150  200  250 9999   all</span></span>
<span><span class="co">#&gt; Aphrodite aculeata        NA  NA  NA   NA   NA   NA  1.5   1.5</span></span>
<span><span class="co">#&gt; Callionymus lyra         1.5  NA  NA   NA   NA   NA   NA   1.5</span></span>
<span><span class="co">#&gt; Clupea                    NA 0.3  NA   NA   NA   NA   NA   0.3</span></span>
<span><span class="co">#&gt; Clupea harengus           NA  NA  NA   NA  9.2   NA   NA   9.2</span></span>
<span><span class="co">#&gt; Corystes cassivelanus     NA  NA  NA   NA   NA   NA  0.7   0.7</span></span>
<span><span class="co">#&gt; Hippogloss. Platessoides  NA  NA 1.9  5.0   NA   NA   NA   6.8</span></span>
<span><span class="co">#&gt; Limanda limanda          0.4 2.9 3.8 21.2 11.1   NA   NA  39.3</span></span>
<span><span class="co">#&gt; Macropipus holsatus       NA  NA  NA   NA   NA   NA  0.5   0.5</span></span>
<span><span class="co">#&gt; Merlangius merlangus      NA  NA  NA   NA   NA 31.9   NA  31.9</span></span>
<span><span class="co">#&gt; Solea solea               NA  NA  NA  8.2   NA   NA   NA   8.2</span></span>
<span><span class="co">#&gt; all                      1.9 3.2 5.7 34.4 20.3 31.9  2.7 100.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  sample_id: Gadus morhua_SCO_y:91_q:1_ID:582  fish_id: 582 </span></span>
<span><span class="co">#&gt;                       120  200 9999   all</span></span>
<span><span class="co">#&gt; Clupea harengus        NA 77.2   NA  77.2</span></span>
<span><span class="co">#&gt; Trisopterus esmarkii 22.7   NA    0  22.8</span></span>
<span><span class="co">#&gt; all                  22.7 77.2    0 100.0</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="change-and-edit-stomach-data">Change and edit stomach data<a class="anchor" aria-label="anchor" href="#change-and-edit-stomach-data"></a>
</h3>
<p>The function change_data() gives the opportunities to make changes,
often used in the stomach data compilation and to add additional fields.
See the full documentation change_data() for details. In this example,
change_data() is run with default parameters. This will in this case
include the two values n_tot (total number of stomachs) and record_type
(flag for single or pooled stomachs). After the Change_data() is
executed, the “Changes done” is set to TRUE.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/change_data.html">change_data</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s</span></span>
<span><span class="co">#&gt; Object of class 'STOMobs'</span></span>
<span><span class="co">#&gt; ===========================</span></span>
<span><span class="co">#&gt; Number of samples: 4104 </span></span>
<span><span class="co">#&gt; Number stomachs: 9660 </span></span>
<span><span class="co">#&gt; Predators: Gadus morhua </span></span>
<span><span class="co">#&gt; Number of prey names: 222 </span></span>
<span><span class="co">#&gt; Years: 1991 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; TRUE:  Changes done</span></span>
<span><span class="co">#&gt; TRUE:  Prey weights by record done</span></span>
<span><span class="co">#&gt; FALSE: Bias corrected, energy contents, armament etc</span></span>
<span><span class="co">#&gt; FALSE: Predator size class assigned</span></span>
<span><span class="co">#&gt; FALSE: Bias corrected, regurgitated stomachs</span></span>
<span><span class="co">#&gt; FALSE: Prey size class assigned</span></span>
<span><span class="co">#&gt; FALSE: Aggregate by sample ID and predator and prey size group</span></span>
<span><span class="co">#&gt; FALSE: Temporal and spatial strata added</span></span>
<span><span class="co">#&gt; FALSE: Allocate partly identified prey species</span></span>
<span><span class="co">#&gt; FALSE: Allocate missing prey length</span></span></code></pre></div>
<p>The next step “Prey weights by record done” is an option for some
data (e.g. Baltic cod data) where the prey weight used is the weight of
all sizes combined, and not by the individual prey length class. For
this example data, all weights are by prey length (i.e. by record), so
it is not necessary to run the function
individual_prey_weights_from_pooled_weights. This is also shown in the
output above where “Prey weights by record done” is set to TRUE as part
of the change_data() call.</p>
<p>There are also special functions to add data, which will be explained
later on. For now, NODC codes are assigned by the function add_NODC_ID
for each predator and prey species.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">s</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/add_NODC_ID.html">add_NODC_ID</a></span><span class="op">(</span><span class="va">s</span>, predator_or_prey <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"predator"</span>, <span class="st">"prey"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> </span>
<span><span class="va">s</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/add_NODC_ID.html">add_NODC_ID</a></span><span class="op">(</span><span class="va">s</span>, predator_or_prey <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"predator"</span>, <span class="st">"prey"</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="accessing-data-directly">Accessing data directly<a class="anchor" aria-label="anchor" href="#accessing-data-directly"></a>
</h3>
<p>As explained previously, a STOMobs object consist of a list with data
for the predator (e.g. implemented as s[[‘PRED’]]) and the prey
(e.g. implemented as s[[‘PREY’]]), which are linked by the variables
sample_id and fish_id. This structure makes it possible to edit each
data set independently, as shown below.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># add a variable, box17 to the predator set</span></span>
<span><span class="va">s</span><span class="op">[[</span><span class="st">'PRED'</span><span class="op">]</span><span class="op">]</span><span class="op">&lt;-</span> <span class="va">s</span><span class="op">[[</span><span class="st">'PRED'</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>box17<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">rectangle</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'40F6'</span>,<span class="st">'40F7'</span><span class="op">)</span>,<span class="st">'inside'</span>,<span class="st">'outside'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># s&lt;-update(s) # you have to run update() after adding or removing variables to keep changes (not done here)</span></span></code></pre></div>
<p>Another way of doing it, which is preferable when both data from both
predator and preys are used, is to transform data into a data.frame,
where changes can be made, and afterwards transform data back again to a
STOMobs object. In the example below, the variables “cannibal” and
“large_prey” require input from both PRED and PREY.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">tst</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>cannibal<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">pred_name</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">prey_name</span><span class="op">)</span>, </span>
<span>               large_prey<span class="op">=</span><span class="va">prey_l</span><span class="op">&gt;</span> <span class="va">pred_l</span><span class="op">*</span><span class="fl">0.3</span>,box17<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu"><a href="../reference/as_STOMobs.html">as_STOMobs</a></span><span class="op">(</span>new_pred_var<span class="op">=</span><span class="st">'cannibal'</span>,new_prey_var<span class="op">=</span><span class="st">'large_prey'</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">tst</span><span class="op">[[</span><span class="st">'PRED'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "dataset"     "country"     "ship"        "rectangle"   "area"       </span></span>
<span><span class="co">#&gt;  [6] "year"        "quarter"     "month"       "day"         "station"    </span></span>
<span><span class="co">#&gt; [11] "haul"        "sample_id"   "fish_id"     "record_type" "pred_name"  </span></span>
<span><span class="co">#&gt; [16] "pred_l"      "pred_ll"     "pred_lu"     "n_tot"       "n_food"     </span></span>
<span><span class="co">#&gt; [21] "n_regur"     "n_skel"      "n_empty"     "pred_nodc"   "cannibal"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">tst</span><span class="op">[[</span><span class="st">'PREY'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "sample_id"   "fish_id"     "prey_name"   "digest"      "prey_l"     </span></span>
<span><span class="co">#&gt;  [6] "prey_ll"     "prey_lu"     "prey_w_meth" "prey_n"      "prey_w"     </span></span>
<span><span class="co">#&gt; [11] "prey_nodc"   "large_prey"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">tst</span><span class="op">)</span></span></code></pre></div>
<p>The new_pred_var=‘cannibal’ specifies that a new variable cannibal
should be added to the data set PRED, whereas new_prey_var=‘large_prey’
specifies that large_prey belongs to the PREY. The “box17” made
previously is deleted.</p>
<p>By using the method as.data.frame followed by the the function
as_STOMobs, attributes and the attached control object are kept updated
automatically.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Morten Vinther.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
