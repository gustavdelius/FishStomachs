<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Example 06 Bootstrapping • FishStomachs</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Example 06 Bootstrapping">
<meta property="og:description" content="FishStomachs">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FishStomachs</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/FishStomachs.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ex01_Read_and_manipulate_data.html">example 01: Read and manipulate data</a>
    </li>
    <li>
      <a href="../articles/ex02_More_data_manipulations.html">Example 02: More data manipulations</a>
    </li>
    <li>
      <a href="../articles/ex03_Estimate_population_diet.html">Example 03: Estimate population diet</a>
    </li>
    <li>
      <a href="../articles/ex04_Population_diet.html">Example 04: Population diet</a>
    </li>
    <li>
      <a href="../articles/ex05_Create_data_for_model.html">Example 05:Create data for model</a>
    </li>
    <li>
      <a href="../articles/ex06_Bootstrapping.html">Example 06 Bootstrapping</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Example 06 Bootstrapping</h1>
            
      
      
      <div class="hidden name"><code>ex06_Bootstrapping.Rmd</code></div>

    </div>

    
    
<p>FishStomachs provides functions for estimating the mean and variance
of the stomach contents from bootstrapping. First, data from Example 03
are loaded.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">FishStomachs</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span> package <span class="op">=</span> <span class="st">"FishStomachs"</span><span class="op">)</span>,<span class="st">"extdata"</span>,<span class="st">"ex03half.Rdata"</span><span class="op">)</span>,verbose<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading objects:</span></span>
<span><span class="co">#&gt;   s</span></span></code></pre></div>
<p>Options for bootstrapping are provided by the bootstrapping control
(see below). It is a list, where boots_strata defines the strata for
bootstrapping, in this case data are made for each combination of year,
quarter and predator. Within such stratum, bootstrap samples are drawn
from the pool of boots_id, in this case defined as individual trawl
hauls. The variable predator_size is not used for boots_strata to
reflect that several predator lengths are often sampled at the same
haul. If you want to draw replicates from the pool of samples (haul,
predator and predator size) for each predator size, the boots_strata
should include the predator size as well (boots_strata =
expression(paste(year,quarter,pred_name, pred_size,sep=‘-’)).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">############### add variables for bootstrapping</span></span>
<span><span class="va">s</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/edit_control.html">edit_control</a></span><span class="op">(</span><span class="va">s</span>, bootstrapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        boots_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">ship</span>,<span class="va">rectangle</span>,<span class="va">year</span>,<span class="va">quarter</span>,<span class="va">station</span>,<span class="va">haul</span>,sep<span class="op">=</span><span class="st">'_'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        boots_strata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">year</span>,<span class="va">quarter</span>,<span class="va">pred_name</span>,sep<span class="op">=</span><span class="st">'-'</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; bootstrapping type; list TRUE</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_control.html">get_control</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span>,<span class="st">'bootstrapping'</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; #### group: bootstrapping </span></span>
<span><span class="co">#&gt; bootstrapping: List of 2</span></span>
<span><span class="co">#&gt;  $ boots_id    :  expression(paste(ship, rectangle, year, quarter, station, haul, sep = "_"))</span></span>
<span><span class="co">#&gt;  $ boots_strata:  expression(paste(year, quarter, pred_name, sep = "-"))</span></span>
<span><span class="va">s</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/bootstrap_addVar.html">bootstrap_addVar</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">s</span><span class="op">[[</span><span class="st">'PRED'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "dataset"          "country"          "ship"             "rectangle"       </span></span>
<span><span class="co">#&gt;  [5] "area"             "year"             "quarter"          "month"           </span></span>
<span><span class="co">#&gt;  [9] "day"              "station"          "haul"             "sample_id"       </span></span>
<span><span class="co">#&gt; [13] "pred_name"        "pred_nodc"        "box17"            "pred_size_class" </span></span>
<span><span class="co">#&gt; [17] "pred_size"        "n_tot"            "pred_l_mean"      "fish_id"         </span></span>
<span><span class="co">#&gt; [21] "stratum_time"     "stratum_area"     "stratum_sub_area" "boots_id"        </span></span>
<span><span class="co">#&gt; [25] "boots_strata"</span></span></code></pre></div>
<p>The call to bootstrap_addVar() adds the variables for bootstrapping
to data.</p>
<p>The resulting stratification is shown below.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/bootstrap_show.html">bootstrap_show</a></span><span class="op">(</span><span class="va">s</span>,show<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"strata"</span>,<span class="st">'sample'</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,vari<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"stomach"</span>,<span class="st">"sample"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; , , pred_name = Gadus morhua</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                      pred_size</span></span>
<span><span class="co">#&gt; boots_strata          0100-0149 0150-0199 0200-0249 0250-0299 0300-0399</span></span>
<span><span class="co">#&gt;   1991-1-Gadus morhua        42       117       123        61       379</span></span>
<span><span class="co">#&gt;   1991-2-Gadus morhua         6       216       498       331       582</span></span>
<span><span class="co">#&gt;   1991-3-Gadus morhua       248         4       149       392       478</span></span>
<span><span class="co">#&gt;   1991-4-Gadus morhua       569       478       149       112       544</span></span>
<span><span class="co">#&gt;                      pred_size</span></span>
<span><span class="co">#&gt; boots_strata          0400-0499 0500-0699 0700-0999 1000-1499</span></span>
<span><span class="co">#&gt;   1991-1-Gadus morhua       327       610       444        84</span></span>
<span><span class="co">#&gt;   1991-2-Gadus morhua       565       675       211        30</span></span>
<span><span class="co">#&gt;   1991-3-Gadus morhua       263       264        77        10</span></span>
<span><span class="co">#&gt;   1991-4-Gadus morhua       231       257       121        13</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/bootstrap_show.html">bootstrap_show</a></span><span class="op">(</span><span class="va">s</span>,show<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"strata"</span>,<span class="st">'sample'</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,vari<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"stomach"</span>,<span class="st">"sample"</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; , , pred_name = Gadus morhua</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                      pred_size</span></span>
<span><span class="co">#&gt; boots_strata          0100-0149 0150-0199 0200-0249 0250-0299 0300-0399</span></span>
<span><span class="co">#&gt;   1991-1-Gadus morhua        18        51        56        29       128</span></span>
<span><span class="co">#&gt;   1991-2-Gadus morhua         6       107       213       115       241</span></span>
<span><span class="co">#&gt;   1991-3-Gadus morhua        62         4        68       178       263</span></span>
<span><span class="co">#&gt;   1991-4-Gadus morhua       153       108        62        55       223</span></span>
<span><span class="co">#&gt;                      pred_size</span></span>
<span><span class="co">#&gt; boots_strata          0400-0499 0500-0699 0700-0999 1000-1499</span></span>
<span><span class="co">#&gt;   1991-1-Gadus morhua       122       301       238        62</span></span>
<span><span class="co">#&gt;   1991-2-Gadus morhua       182       244       137        24</span></span>
<span><span class="co">#&gt;   1991-3-Gadus morhua       122       144        52         9</span></span>
<span><span class="co">#&gt;   1991-4-Gadus morhua        97       134        84        12</span></span></code></pre></div>
<p>The tables above shows that e.g. cod in quarter 1 has 18 “hauls” with
in total 42 stomachs for predator size 0100-0149. The table below shows
that each “haul” includes a number of stomachs from various predator
sizes.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/bootstrap_show.html">bootstrap_show</a></span><span class="op">(</span><span class="va">s</span>,show<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"strata"</span>,<span class="st">'sample'</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,vari<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"stomach"</span>,<span class="st">"sample"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; , , pred_name = Gadus morhua</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                          pred_size</span></span>
<span><span class="co">#&gt; boots_id                  0100-0149 0150-0199 0200-0249 0250-0299 0300-0399</span></span>
<span><span class="co">#&gt;   CIR_32F2_1991_2_3_3             0         0         1         1         1</span></span>
<span><span class="co">#&gt;   CIR_32F2_1991_3_5_5             0         0         0         0        11</span></span>
<span><span class="co">#&gt;   CIR_32F3_1991_2_5_5             0         0         3         4         4</span></span>
<span><span class="co">#&gt;   CIR_32F3_1991_4_121_121         1         0         0         0         0</span></span>
<span><span class="co">#&gt;   CIR_33F2_1991_3_7_7             0         0         0         0         4</span></span>
<span><span class="co">#&gt;   CIR_33F3_1991_3_20_20           0         0         0         1         0</span></span>
<span><span class="co">#&gt;                          pred_size</span></span>
<span><span class="co">#&gt; boots_id                  0400-0499 0500-0699 0700-0999 1000-1499</span></span>
<span><span class="co">#&gt;   CIR_32F2_1991_2_3_3             0         3         2         0</span></span>
<span><span class="co">#&gt;   CIR_32F2_1991_3_5_5             3         0         0         0</span></span>
<span><span class="co">#&gt;   CIR_32F3_1991_2_5_5             0         0         0         0</span></span>
<span><span class="co">#&gt;   CIR_32F3_1991_4_121_121         0         1         0         0</span></span>
<span><span class="co">#&gt;   CIR_33F2_1991_3_7_7             2         3         1         0</span></span>
<span><span class="co">#&gt;   CIR_33F3_1991_3_20_20           0         0         0         0</span></span></code></pre></div>
<p>We are now ready to do the bootstrapping, however to speed up, task
common for all replicates are done first. That is the definition of the
included prey species and the specification of stratifications for
calculation population diet.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># a very complex way of getting a list of prey names!</span></span>
<span><span class="va">keep_prey</span> <span class="op">&lt;-</span><span class="op">(</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span> package <span class="op">=</span> <span class="st">"FishStomachs"</span><span class="op">)</span>,<span class="st">"extdata"</span>,<span class="st">"species_info.csv"</span><span class="op">)</span>,</span>
<span>                      col_types <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html" class="external-link">cols</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>  <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>               <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">prey_sp</span><span class="op">)</span>  <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">species</span></span>
<span><span class="va">keep_prey</span> <span class="co">#input is just a vector of prey names</span></span>
<span><span class="co">#&gt; [1] "Gadus morhua"             "Merlangius merlangus"    </span></span>
<span><span class="co">#&gt; [3] "Melanogrammus aeglefinus" "Clupea harengus"         </span></span>
<span><span class="co">#&gt; [5] "Ammodytidae"              "Trisopterus esmarkii"    </span></span>
<span><span class="co">#&gt; [7] "Sprattus sprattus"</span></span>
<span></span>
<span><span class="va">s</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/edit_control.html">edit_control</a></span><span class="op">(</span><span class="va">s</span>,sel_preys<span class="op">=</span><span class="va">keep_prey</span><span class="op">)</span></span>
<span><span class="co">#&gt; sel_preys type; vector TRUE</span></span>
<span></span>
<span><span class="va">from_to</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/make_from_to_species.html">make_from_to_species</a></span><span class="op">(</span>inp_file<span class="op">=</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span> package <span class="op">=</span> <span class="st">"FishStomachs"</span><span class="op">)</span>,<span class="st">"extdata"</span>,<span class="st">"from_to_species.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/edit_control.html">edit_control</a></span><span class="op">(</span><span class="va">s</span>,</span>
<span>                calc_sub_strata<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                  <span class="co"># transform into relative weight before data are compiled</span></span>
<span>                  relative_weight<span class="op">=</span><span class="cn">FALSE</span>,      </span>
<span>                  <span class="co"># use number of stomach in the sample as weighting factor</span></span>
<span>                  weighting_factor<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">n_tot</span><span class="op">)</span>,</span>
<span>                  <span class="co"># set file to NA when weighting_factor is given</span></span>
<span>                  weighting_factor_file<span class="op">=</span><span class="cn">NA</span></span>
<span>                <span class="op">)</span>,</span>
<span>                calc_strata<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                  relative_weight<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>                  weighting_factor<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">mean_cpue</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  weighting_factor_file<span class="op">=</span><span class="cn">NA</span></span>
<span>                <span class="op">)</span>,</span>
<span>                calc_total<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                  relative_weight<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>                  <span class="co"># set to NA when input is provided in a file</span></span>
<span>                  weighting_factor<span class="op">=</span><span class="cn">NA</span>,</span>
<span>                  <span class="co"># use data from a specified file (in those case, a file provided by the FishStomachs)</span></span>
<span>                  weighting_factor_file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span> package <span class="op">=</span> <span class="st">"FishStomachs"</span><span class="op">)</span>,<span class="st">"extdata"</span>,<span class="st">"weighting_total.csv"</span><span class="op">)</span></span>
<span>                <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; calc_sub_strata type; list TRUE </span></span>
<span><span class="co">#&gt; calc_strata type; list TRUE </span></span>
<span><span class="co">#&gt; calc_total type; list TRUE</span></span></code></pre></div>
<p>The processing of observations into population diet is put into a
function, do_boots, which is user defined. In this case the code
included in do_boots is copied from Example 03.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">do_boots</span><span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">s</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span><span class="co"># cat('*') # to show that something is happening  </span></span>
<span>  </span>
<span><span class="co"># to keep information on bootstrap replicate  </span></span>
<span><span class="va">rep_id</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">s</span><span class="op">[[</span><span class="st">'PRED'</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span>,<span class="st">'rep_id'</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># by sample</span></span>
<span><span class="va">s</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/redist_unidentified_prey_sp.html">redist_unidentified_prey_sp</a></span><span class="op">(</span><span class="va">s</span>,dist_time<span class="op">=</span><span class="va">stratum_time</span>,dist_area<span class="op">=</span><span class="va">sample_id</span>,</span>
<span>        dist_pred_size<span class="op">=</span><span class="va">pred_size</span>, do_only<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,from_to_species<span class="op">=</span><span class="va">from_to</span>,</span>
<span>        by_prey_size<span class="op">=</span><span class="cn">FALSE</span>,remains_to_other <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># by sub_area (=rectangel)</span></span>
<span><span class="va">s</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/redist_unidentified_prey_sp.html">redist_unidentified_prey_sp</a></span><span class="op">(</span><span class="va">s</span>,dist_time<span class="op">=</span><span class="va">stratum_time</span>,dist_area<span class="op">=</span><span class="va">stratum_sub_area</span>,</span>
<span>        dist_pred_size<span class="op">=</span><span class="va">pred_size</span>, do_only<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,from_to_species<span class="op">=</span><span class="va">from_to</span>,</span>
<span>        by_prey_size<span class="op">=</span><span class="cn">FALSE</span>,remains_to_other <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># by area (=roundfish area)</span></span>
<span><span class="va">s</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/redist_unidentified_prey_sp.html">redist_unidentified_prey_sp</a></span><span class="op">(</span><span class="va">s</span>,dist_time<span class="op">=</span><span class="va">stratum_time</span>,dist_area<span class="op">=</span><span class="va">stratum_area</span>,</span>
<span>        dist_pred_size<span class="op">=</span><span class="va">pred_size</span>, do_only<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>,from_to_species<span class="op">=</span><span class="va">from_to</span>,</span>
<span>        by_prey_size<span class="op">=</span><span class="cn">FALSE</span>,remains_to_other <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># all areas</span></span>
<span><span class="va">s</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/redist_unidentified_prey_sp.html">redist_unidentified_prey_sp</a></span><span class="op">(</span><span class="va">s</span>,dist_time<span class="op">=</span><span class="va">stratum_time</span>,dist_area<span class="op">=</span><span class="st">'All'</span>,</span>
<span>        dist_pred_size<span class="op">=</span><span class="va">pred_size</span>, do_only<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>,from_to_species<span class="op">=</span><span class="va">from_to</span>,</span>
<span>        by_prey_size<span class="op">=</span><span class="cn">FALSE</span>,remains_to_other <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># all areas and half-year (dist_time is changed)</span></span>
<span><span class="va">s</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/redist_unidentified_prey_sp.html">redist_unidentified_prey_sp</a></span><span class="op">(</span><span class="va">s</span>,dist_time<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">year</span>,<span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">quarter</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,<span class="st">'S1'</span>,<span class="st">'S2'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        dist_area<span class="op">=</span><span class="st">'All'</span>,dist_pred_size<span class="op">=</span><span class="va">pred_size</span>, do_only<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>,from_to_species<span class="op">=</span><span class="va">from_to</span>,</span>
<span>        by_prey_size<span class="op">=</span><span class="cn">FALSE</span>,remains_to_other <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># the same as above, but unallocated remains to "other food".</span></span>
<span><span class="va">s</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/redist_unidentified_prey_sp.html">redist_unidentified_prey_sp</a></span><span class="op">(</span><span class="va">s</span>,dist_time<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">year</span>,<span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">quarter</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,<span class="st">'S1'</span>,<span class="st">'S2'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        dist_area<span class="op">=</span><span class="st">'All'</span>,dist_pred_size<span class="op">=</span><span class="va">pred_size</span>, do_only<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>,from_to_species<span class="op">=</span><span class="va">from_to</span>,</span>
<span>        by_prey_size<span class="op">=</span><span class="cn">FALSE</span>,remains_to_other <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># by statum_area (=roundfish area)</span></span>
<span><span class="va">s</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/redist_unidentified_prey_lengths.html">redist_unidentified_prey_lengths</a></span><span class="op">(</span><span class="va">s</span>,dist_time<span class="op">=</span><span class="va">stratum_time</span>,dist_area<span class="op">=</span><span class="va">stratum_area</span>,</span>
<span>      dist_pred_size<span class="op">=</span><span class="va">pred_size</span>,</span>
<span>      remains_to_other <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># do not add records with missing length allocation to "other food"</span></span>
<span>      others_to_other<span class="op">=</span><span class="cn">TRUE</span>      <span class="co"># do add other species that selected prey species to "other food"</span></span>
<span>      <span class="op">)</span></span>
<span></span>
<span><span class="co"># within all areas</span></span>
<span><span class="va">s</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/redist_unidentified_prey_lengths.html">redist_unidentified_prey_lengths</a></span><span class="op">(</span><span class="va">s</span>,dist_time<span class="op">=</span><span class="va">stratum_time</span>,dist_area<span class="op">=</span><span class="st">'All'</span>,</span>
<span>      dist_pred_size<span class="op">=</span><span class="va">pred_size</span>,remains_to_other <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#  within all areas, and year (ignoring quarter)</span></span>
<span><span class="va">s</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/redist_unidentified_prey_lengths.html">redist_unidentified_prey_lengths</a></span><span class="op">(</span>s<span class="op">=</span><span class="va">s</span>,dist_time<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">stratum_time</span>,<span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span>,dist_area<span class="op">=</span><span class="st">'All'</span>,</span>
<span>      dist_pred_size<span class="op">=</span><span class="va">pred_size</span>,remains_to_other <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># as above, but with conversion of unallocated into "other"</span></span>
<span><span class="va">s</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/redist_unidentified_prey_lengths.html">redist_unidentified_prey_lengths</a></span><span class="op">(</span>s<span class="op">=</span><span class="va">s</span>,dist_time<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">stratum_time</span>,<span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span>,dist_area<span class="op">=</span><span class="st">'All'</span>,</span>
<span>      dist_pred_size<span class="op">=</span><span class="va">pred_size</span>,remains_to_other <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">d</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/calc_population_stom.html">calc_population_stom</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span></span>
<span><span class="va">d</span><span class="op">[[</span><span class="st">'PRED'</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">rep_id</span><span class="op">&lt;-</span><span class="va">rep_id</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The creation of data for bootstrapping is done by the function
bootstrap_data(), which create a new STOMobs object including the
bootstrap replicate data. The result of the call, bd, is a list with
STOMobs object.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">n_boot</span><span class="op">&lt;-</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>  <span class="co"># make 3 bootstrap replicates</span></span>
<span><span class="va">bd</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">n_boot</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="../reference/bootstrap_data.html">bootstrap_data</a></span><span class="op">(</span><span class="va">s</span>,seed<span class="op">=</span><span class="va">x</span>,rep_id<span class="op">=</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">bd</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,show_attributes<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Object of class 'STOMobs'</span></span>
<span><span class="co">#&gt; ===========================</span></span>
<span><span class="co">#&gt; Number of samples: 4231 </span></span>
<span><span class="co">#&gt; Number stomachs: 9054 </span></span>
<span><span class="co">#&gt; Predators: Gadus morhua </span></span>
<span><span class="co">#&gt; Number of prey names: 12 </span></span>
<span><span class="co">#&gt; Years: 1991</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">bd</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,show_attributes<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Object of class 'STOMobs'</span></span>
<span><span class="co">#&gt; ===========================</span></span>
<span><span class="co">#&gt; Number of samples: 3882 </span></span>
<span><span class="co">#&gt; Number stomachs: 8798 </span></span>
<span><span class="co">#&gt; Predators: Gadus morhua </span></span>
<span><span class="co">#&gt; Number of prey names: 12 </span></span>
<span><span class="co">#&gt; Years: 1991</span></span></code></pre></div>
<p>The calculation of the population diet is done for each STOMobs
object as shown below. The result is a list of STOMdiet objects.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#convert observations into population diet</span></span>
<span><span class="va">bt</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">bd</span>,<span class="va">do_boots</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bt</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="co"># STOMdiet object </span></span>
<span><span class="co">#&gt; Object of class 'STOMdiet'</span></span>
<span><span class="co">#&gt; ===========================</span></span>
<span><span class="co">#&gt; Number stomachs: 9054 </span></span>
<span><span class="co">#&gt; Predators: Gadus morhua </span></span>
<span><span class="co">#&gt; Number of prey names: 8 </span></span>
<span><span class="co">#&gt; Prey names:Ammodytidae; Clupea harengus; Gadus morhua; Melanogrammus aeglefinus; </span></span>
<span><span class="co">#&gt;     Merlangius merlangus; Sprattus sprattus; Trisopterus esmarkii; other; </span></span>
<span><span class="co">#&gt; Temporal strata: 1991-Q1;  1991-Q2;  1991-Q3;  1991-Q4;</span></span>
<span></span>
<span><span class="va">bt</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="co"># STOMdiet object </span></span>
<span><span class="co">#&gt; Object of class 'STOMdiet'</span></span>
<span><span class="co">#&gt; ===========================</span></span>
<span><span class="co">#&gt; Number stomachs: 8798 </span></span>
<span><span class="co">#&gt; Predators: Gadus morhua </span></span>
<span><span class="co">#&gt; Number of prey names: 8 </span></span>
<span><span class="co">#&gt; Prey names:Ammodytidae; Clupea harengus; Gadus morhua; Melanogrammus aeglefinus; </span></span>
<span><span class="co">#&gt;     Merlangius merlangus; Sprattus sprattus; Trisopterus esmarkii; other; </span></span>
<span><span class="co">#&gt; Temporal strata: 1991-Q1;  1991-Q2;  1991-Q3;  1991-Q4;</span></span></code></pre></div>
<p>The STOMdiet can be changed. In this case predator and prey names are
changed into English names and prey weights into relative weights</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">bt2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">bt</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span> <span class="va">x</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/from_to_species_diet.html">from_to_species_diet</a></span><span class="op">(</span><span class="va">x</span>,pred_from_to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"species"</span>,<span class="st">"short"</span><span class="op">)</span>,prey_from_to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"species"</span>,<span class="st">"short"</span><span class="op">)</span>,</span>
<span>      sp_info_file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span> package <span class="op">=</span> <span class="st">"FishStomachs"</span><span class="op">)</span>,<span class="st">"extdata"</span>,<span class="st">'species_info.csv'</span><span class="op">)</span><span class="op">)</span></span>
<span> <span class="co">#Relative stomach contents</span></span>
<span> <span class="va">x</span><span class="op">[[</span><span class="st">'PREY'</span><span class="op">]</span><span class="op">]</span><span class="op">&lt;-</span> <span class="va">x</span><span class="op">[[</span><span class="st">'PREY'</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">key</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>   <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>prey_w<span class="op">=</span><span class="va">prey_w</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">prey_w</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># change to English names in the source data for bootstrap, for a later merge</span></span>
<span> <span class="va">source</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/from_to_species_diet.html">from_to_species_diet</a></span><span class="op">(</span><span class="va">s</span>,pred_from_to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"species"</span>,<span class="st">"short"</span><span class="op">)</span>,prey_from_to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"species"</span>,<span class="st">"short"</span><span class="op">)</span>,</span>
<span>    sp_info_file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span> package <span class="op">=</span> <span class="st">"FishStomachs"</span><span class="op">)</span>,<span class="st">"extdata"</span>,<span class="st">'species_info.csv'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The estimated diets for each bootstrap replicates are different as
shown below, where the two first replicates are compared. The size of
the bubbles indicate the difference, d1-d2, between the two diets. Red
is negative, green is positive and blue shows that data are missing in
one of the two sets.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># comparison of two replicates</span></span>
<span><span class="fu"><a href="../reference/plotdif.html">plotdif</a></span><span class="op">(</span>d1<span class="op">=</span><span class="va">bt2</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,d2<span class="op">=</span><span class="va">bt2</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,show_plot<span class="op">=</span><span class="cn">TRUE</span>,cut_pred_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span>,cut_prey_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span>,addTitle<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>        tAngle<span class="op">=</span><span class="fl">90</span>, relative<span class="op">=</span><span class="cn">FALSE</span>,maxDif<span class="op">=</span><span class="fl">3</span>,</span>
<span>        byVar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'year-quarter'</span>,<span class="st">'year'</span>,<span class="st">'quarter'</span>,<span class="st">'none'</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="ex06_Bootstrapping_files/figure-html/ex06_09-1.png" width="672"></p>
<pre><code><span><span class="co">#&gt; NULL</span></span></code></pre>
<p>Missing prey and prey size combination in the bootstrap replicates
can be filled in with a selected value, in this case with zero.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">bt3</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/add_missing_boots.html">add_missing_boots</a></span><span class="op">(</span><span class="va">bt2</span>, mis_value<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plotdif.html">plotdif</a></span><span class="op">(</span>d1<span class="op">=</span><span class="va">bt3</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,d2<span class="op">=</span><span class="va">bt3</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,show_plot<span class="op">=</span><span class="cn">TRUE</span>,cut_pred_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span>,cut_prey_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span>,addTitle<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>        tAngle<span class="op">=</span><span class="fl">90</span>, relative<span class="op">=</span><span class="cn">FALSE</span>, maxDif<span class="op">=</span><span class="fl">3</span>,</span>
<span>        byVar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'year-quarter'</span>,<span class="st">'year'</span>,<span class="st">'quarter'</span>,<span class="st">'none'</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="ex06_Bootstrapping_files/figure-html/ex06_10-1.png" width="672"></p>
<pre><code><span><span class="co">#&gt; NULL</span></span></code></pre>
<p>Plots of the bootstrapped diet are available. In the case below, a
subset of data the replicates are first made, and the distribution of
the individual replicates are shown, by prey species and their size.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># sub set for plot</span></span>
<span><span class="va">bt4</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">bt3</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">pred_name</span><span class="op">==</span><span class="st">'Cod'</span> <span class="op">&amp;</span>  <span class="va">pred_size</span><span class="op">==</span><span class="st">'0400-0499'</span> <span class="op">&amp;</span> <span class="va">stratum_time</span><span class="op">==</span><span class="st">'1991-Q1'</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plotboots.size.html">plotboots.size</a></span><span class="op">(</span>b<span class="op">=</span><span class="va">bt4</span>,show_plot<span class="op">=</span><span class="cn">TRUE</span>,cut_pred_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">10</span><span class="op">)</span>,cut_prey_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span>,addTitle<span class="op">=</span><span class="cn">TRUE</span>,tAngle<span class="op">=</span><span class="fl">90</span><span class="op">)</span></span></code></pre></div>
<p><img src="ex06_Bootstrapping_files/figure-html/ex06_11-1.png" width="672"></p>
<pre><code><span><span class="co">#&gt; NULL</span></span></code></pre>
<p>In another plot, prey sizes are combined, and the plot show the
distribution of prey weight by prey species and predator size.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sub set for plot</span></span>
<span><span class="va">bt4</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">bt3</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">pred_name</span><span class="op">==</span><span class="st">'Cod'</span> <span class="op">&amp;</span> <span class="va">stratum_time</span><span class="op">==</span><span class="st">'1991-Q1'</span> <span class="op">&amp;</span> <span class="op">!</span><span class="op">(</span><span class="va">pred_size</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'0100-0149'</span>,<span class="st">'0150-0199'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="../reference/plotboots.html">plotboots</a></span><span class="op">(</span>b<span class="op">=</span><span class="va">bt4</span>,show_plot<span class="op">=</span><span class="cn">TRUE</span>,cut_pred_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span>,addTitle<span class="op">=</span><span class="cn">TRUE</span>,tAngle<span class="op">=</span><span class="fl">90</span><span class="op">)</span></span></code></pre></div>
<p><img src="ex06_Bootstrapping_files/figure-html/ex06_12-1.png" width="672"></p>
<pre><code><span><span class="co">#&gt; NULL</span></span></code></pre>
<p>The bootstrap mean and variance from replicates are calculated by a
call to bootsMean(). See help(bootsMean) for more information.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="co"># load diet data (point estimate) from example 03</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span> package <span class="op">=</span> <span class="st">"FishStomachs"</span><span class="op">)</span>,<span class="st">"extdata"</span>,<span class="st">"ex03d.Rdata"</span><span class="op">)</span>,verbose<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading objects:</span></span>
<span><span class="co">#&gt;   d</span></span>
<span></span>
<span><span class="co"># change from latin to English names (used later on) </span></span>
<span> <span class="va">pointEst</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/from_to_species_diet.html">from_to_species_diet</a></span><span class="op">(</span><span class="va">d</span>,pred_from_to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"species"</span>,<span class="st">"short"</span><span class="op">)</span>,prey_from_to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"species"</span>,<span class="st">"short"</span><span class="op">)</span>,</span>
<span>    sp_info_file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span> package <span class="op">=</span> <span class="st">"FishStomachs"</span><span class="op">)</span>,<span class="st">"extdata"</span>,<span class="st">'species_info.csv'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">bb</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/bootsMean.html">bootsMean</a></span><span class="op">(</span>b<span class="op">=</span><span class="va">bt4</span>,<span class="va">pointEst</span>,by_prey_size<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">bb</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 18</span></span></span>
<span><span class="co">#&gt;   nboots  year quarter pred_name pred_…¹ prey  n_pre…² phi   param mu    p_value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>      3  <span style="text-decoration: underline;">1</span>991       1 Cod       0200-0… Sand…       3 <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>      3  <span style="text-decoration: underline;">1</span>991       1 Cod       0200-0… Sprat       3 <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>      3  <span style="text-decoration: underline;">1</span>991       1 Cod       0200-0… other       3 <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>      3  <span style="text-decoration: underline;">1</span>991       1 Cod       0250-0… Sand…       3 <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>      3  <span style="text-decoration: underline;">1</span>991       1 Cod       0250-0… Nor.…       3 <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>      3  <span style="text-decoration: underline;">1</span>991       1 Cod       0250-0… other       3 <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 7 more variables: mean_w &lt;dbl&gt;, sd_w &lt;dbl&gt;, n_stom &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   n_sample &lt;int&gt;, prey_w &lt;dbl&gt;, prey_name &lt;fct&gt;, prey_size &lt;chr&gt;, and</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   abbreviated variable names ¹​pred_size, ²​n_prey_sp</span></span></span>
<span></span>
<span><span class="fu"><a href="../reference/plotboots.html">plotboots</a></span><span class="op">(</span>b<span class="op">=</span><span class="va">bt4</span>,show_plot<span class="op">=</span><span class="cn">TRUE</span>,cut_pred_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span>,addTitle<span class="op">=</span><span class="cn">TRUE</span>,tAngle<span class="op">=</span><span class="fl">90</span><span class="op">)</span></span></code></pre></div>
<p><img src="ex06_Bootstrapping_files/figure-html/ex06_13-1.png" width="672"></p>
<pre><code><span><span class="co">#&gt; NULL</span></span></code></pre>
<p>With more replicates, loaded from data set.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span> package <span class="op">=</span> <span class="st">"FishStomachs"</span><span class="op">)</span>,<span class="st">"extdata"</span>,<span class="st">"bt4.Rdata"</span><span class="op">)</span>,verbose<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading objects:</span></span>
<span><span class="co">#&gt;   bt4</span></span>
<span></span>
<span><span class="va">bb</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/bootsMean.html">bootsMean</a></span><span class="op">(</span>b<span class="op">=</span><span class="va">bt4</span>,<span class="va">pointEst</span>,by_prey_size<span class="op">=</span><span class="cn">FALSE</span>,do_Diri<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">bb</span>,<span class="va">prey_name</span>, <span class="va">phi</span>,<span class="va">param</span>,<span class="va">mu</span>,<span class="va">mean_w</span>,<span class="va">sd_w</span>,<span class="va">prey_w</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 7</span></span></span>
<span><span class="co">#&gt;   prey_name   phi  param      mu   mean_w     sd_w   prey_w</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Cod        47.7  0.312 0.006<span style="text-decoration: underline;">54</span> 0.000<span style="text-decoration: underline;">426</span> 0.000<span style="text-decoration: underline;">357</span> 0.000<span style="text-decoration: underline;">441</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Whiting    47.7  9.28  0.195   0.197    0.061<span style="text-decoration: underline;">5</span>   0.194   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Haddock    47.7  2.53  0.053<span style="text-decoration: underline;">0</span>  0.061<span style="text-decoration: underline;">0</span>   0.043<span style="text-decoration: underline;">7</span>   0.056<span style="text-decoration: underline;">2</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Herring    47.7  2.02  0.042<span style="text-decoration: underline;">4</span>  0.042<span style="text-decoration: underline;">3</span>   0.024<span style="text-decoration: underline;">9</span>   0.041<span style="text-decoration: underline;">0</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Sandeel    47.7  3.53  0.073<span style="text-decoration: underline;">9</span>  0.078<span style="text-decoration: underline;">9</span>   0.042<span style="text-decoration: underline;">0</span>   0.072<span style="text-decoration: underline;">2</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Nor. Pout  47.7  3.10  0.064<span style="text-decoration: underline;">9</span>  0.061<span style="text-decoration: underline;">7</span>   0.025<span style="text-decoration: underline;">4</span>   0.060<span style="text-decoration: underline;">8</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> Sprat      47.7  0.820 0.017<span style="text-decoration: underline;">2</span>  0.012<span style="text-decoration: underline;">0</span>   0.007<span style="text-decoration: underline;">52</span>  0.013<span style="text-decoration: underline;">0</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> other      47.7 26.1   0.547   0.547    0.067<span style="text-decoration: underline;">7</span>   0.562</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plotboots.html">plotboots</a></span><span class="op">(</span>b<span class="op">=</span><span class="va">bt4</span>,cut_pred_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span>,addTitle<span class="op">=</span><span class="cn">TRUE</span>,tAngle<span class="op">=</span><span class="fl">90</span>,statistics<span class="op">=</span><span class="va">bb</span><span class="op">)</span></span></code></pre></div>
<p><img src="ex06_Bootstrapping_files/figure-html/ex06_14-1.png" width="672"></p>
<pre><code><span><span class="co">#&gt; NULL</span></span></code></pre>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Morten Vinther.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
